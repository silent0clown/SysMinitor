<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿç›‘æ§é¢æ¿</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .usage-meter {
            width: 100%;
            height: 30px;
            background-color: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        .usage-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #FFC107, #F44336);
            transition: width 0.5s ease;
        }
        .disk-usage-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }
        .disk-usage-fill {
            height: 100%;
            background: linear-gradient(90deg, #2196F3, #03A9F4);
            transition: width 0.5s ease;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2196F3;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        /* è¿›ç¨‹åˆ—è¡¨æ ·å¼ */
        .process-header, .disk-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .process-header:hover, .disk-header:hover {
            background: #e9ecef;
        }
        .process-controls, .disk-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .sort-select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        .refresh-btn {
            padding: 5px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .refresh-btn:hover {
            background: #0056b3;
        }
        .process-list, .disk-list {
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .process-table, .disk-table {
            width: 100%;
            border-collapse: collapse;
        }
        .process-table th, .disk-table th {
            background: #f8f9fa;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
        }
        .process-table td, .disk-table td {
            padding: 8px;
            border-bottom: 1px solid #e0e0e0;
        }
        .process-table tr:hover, .disk-table tr:hover {
            background: #f8f9fa;
        }
        .process-name {
            font-weight: 500;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .process-pid {
            color: #666;
            font-family: monospace;
        }
        .process-cpu {
            color: #e74c3c;
            font-weight: 500;
        }
        .process-memory {
            color: #3498db;
            font-weight: 500;
        }
        .process-user {
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .process-state {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .state-running {
            background: #d4edda;
            color: #155724;
        }
        .collapsed .process-list, .collapsed .disk-list {
            display: none;
        }
        .toggle-icon {
            transition: transform 0.3s ease;
        }
        .collapsed .toggle-icon {
            transform: rotate(-90deg);
        }
        .show-all-btn {
            width: 100%;
            padding: 10px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        .show-all-btn:hover {
            background: #545b62;
        }
        
        /* ç£ç›˜ä¿¡æ¯æ ·å¼ */
        .disk-drive-letter {
            font-weight: bold;
            color: #2196F3;
            font-size: 16px;
        }
        .disk-usage-percent {
            font-weight: bold;
            color: #e74c3c;
        }
        .disk-size {
            color: #666;
            font-family: monospace;
        }
        .disk-file-system {
            color: #27ae60;
            font-weight: 500;
        }
        .disk-status {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-healthy {
            background: #d4edda;
            color: #155724;
        }
        .status-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        /* æ€§èƒ½æŒ‡æ ‡æ ·å¼ */
        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .performance-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        .performance-value {
            font-size: 20px;
            font-weight: bold;
            color: #2196F3;
        }
        .performance-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        /* é€‰é¡¹å¡æ ·å¼? */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background: white;
            border-color: #ddd;
            border-bottom-color: white;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–¥ï¸? ç³»ç»Ÿç›‘æ§é¢æ¿</h1>
        
        <div class="card">
            <h2>CPUä½¿ç”¨ç?</h2>
            <div class="usage-meter">
                <div id="usageBar" class="usage-bar" style="width: 0%"></div>
            </div>
            <div id="usageText" style="text-align: center; font-size: 24px; font-weight: bold;">0%</div>
        </div>

        <div class="card">
            <h2>CPUä¿¡æ¯</h2>
            <div id="cpuInfo">
                <p>åŠ è½½ä¸?...</p>
            </div>
        </div>

        <div class="card">
            <h2>å®æ—¶æ•°æ®</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="currentUsage">0%</div>
                    <div class="stat-label">å½“å‰ä½¿ç”¨ç?</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="coreCount">0</div>
                    <div class="stat-label">ç‰©ç†æ ¸å¿ƒ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="threadCount">0</div>
                    <div class="stat-label">é€»è¾‘æ ¸å¿ƒ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="frequency">0</div>
                    <div class="stat-label">åŸºç?€é¢‘ç‡ (MHz)</div>
                </div>
            </div>
        </div>

        <!-- ç£ç›˜ä¿¡æ¯çª—å£ -->
        <div class="card">
            <div class="disk-header" onclick="toggleDiskList()">
                <h2 style="margin: 0;">ç£ç›˜ä¿¡æ¯ 
                    <span id="diskCount" style="font-size: 14px; color: #666; margin-left: 10px;"></span>
                </h2>
                <div class="disk-controls" onclick="event.stopPropagation()">
                    <button class="refresh-btn" onclick="loadDiskInfo()">åˆ·æ–°</button>
                    <span class="toggle-icon">â–?</span>
                </div>
            </div>
            
            <div id="diskList" class="disk-list">
                <!-- é€‰é¡¹å? -->
                <div class="tabs">
                    <div class="tab active" onclick="switchDiskTab('partitions')">åˆ†åŒºä¿¡æ¯</div>
                    <div class="tab" onclick="switchDiskTab('performance')">æ€§èƒ½ç›‘æ§</div>
                    <div class="tab" onclick="switchDiskTab('drives')">ç£ç›˜é©±åŠ¨å™?</div>
                </div>
                
                <!-- åˆ†åŒºä¿¡æ¯æ ‡ç?¾é¡µ -->
                <div id="partitionsTab" class="tab-content active">
                    <table class="disk-table">
                        <thead>
                            <tr>
                                <th width="8%">ç›˜ç??</th>
                                <th width="15%">å·æ ‡</th>
                                <th width="12%">æ–‡ä»¶ç³»ç»Ÿ</th>
                                <th width="15%">æ€»ç©ºé—?</th>
                                <th width="15%">å·²ç”¨ç©ºé—´</th>
                                <th width="15%">å?ç”¨ç©ºé—?</th>
                                <th width="10%">ä½¿ç”¨ç?</th>
                                <th width="10%">çŠ¶æ€?</th>
                            </tr>
                        </thead>
                        <tbody id="partitionsTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 20px;">
                                    åŠ è½½ä¸?...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- æ€§èƒ½ç›‘æ§æ ‡ç?¾é¡µ -->
                <div id="performanceTab" class="tab-content">
                    <div id="performanceContent">
                        <p style="text-align: center; padding: 20px;">åŠ è½½ä¸?...</p>
                    </div>
                </div>
                
                <!-- ç£ç›˜é©±åŠ¨å™¨æ ‡ç­¾é¡µ -->
                <div id="drivesTab" class="tab-content">
                    <table class="disk-table">
                        <thead>
                            <tr>
                                <th width="20%">å‹å·</th>
                                <th width="15%">åºåˆ—å?</th>
                                <th width="10%">æ¥å£ç±»å‹</th>
                                <th width="10%">ä»‹è´¨ç±»å‹</th>
                                <th width="15%">æ€»å?¹é‡</th>
                                <th width="10%">æ‰‡åŒºå¤§å°</th>
                                <th width="10%">çŠ¶æ€?</th>
                                <th width="10%">è®¾å?‡ID</th>
                            </tr>
                        </thead>
                        <tbody id="drivesTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 20px;">
                                    åŠ è½½ä¸?...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- è¿›ç¨‹ä¿¡æ¯çª—å£ -->
        <div class="card">
            <div class="process-header" onclick="toggleProcessList()">
                <h2 style="margin: 0;">è¿›ç¨‹ä¿¡æ¯ 
                    <span id="processCount" style="font-size: 14px; color: #666; margin-left: 10px;"></span>
                </h2>
                <div class="process-controls" onclick="event.stopPropagation()">
                    <span>æ’åºæ–¹å¼:</span>
                    <select class="sort-select" id="sortSelect" onchange="sortProcesses()">
                        <option value="name">è¿›ç¨‹åç§°</option>
                        <option value="cpu">CPUå ç”¨ç?</option>
                        <option value="memory">å†…å­˜å ç”¨</option>
                        <option value="pid">è¿›ç¨‹ID</option>
                    </select>
                    <button class="refresh-btn" onclick="loadProcesses()">åˆ·æ–°</button>
                    <span class="toggle-icon">â–?</span>
                </div>
            </div>
            
            <div id="processList" class="process-list">
                <table class="process-table">
                    <thead>
                        <tr>
                            <th width="5%">PID</th>
                            <th width="20%">è¿›ç¨‹åç§°</th>
                            <th width="10%">CPU</th>
                            <th width="15%">å†…å­˜</th>
                            <th width="10%">çº¿ç¨‹</th>
                            <th width="15%">ç”¨æˆ·å?</th>
                            <th width="10%">çŠ¶æ€?</th>
                            <th width="15%">è·?å¾?</th>
                        </tr>
                    </thead>
                    <tbody id="processTableBody">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 20px;">
                                åŠ è½½ä¸?...
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button class="show-all-btn" onclick="toggleAllProcesses()">æ˜¾ç¤ºå…¨éƒ¨è¿›ç¨‹</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let allProcesses = [];
        let showAllProcesses = false;
        let currentSort = 'name';
        let diskData = {};

        // è·å–CPUä¿¡æ¯
        async function fetchCPUInfo() {
            try {
                const response = await fetch('/api/cpu/info');
                const data = await response.json();
                
                document.getElementById('cpuInfo').innerHTML = `
                    <p><strong>åç§°:</strong> ${data.name}</p>
                    <p><strong>æ¶æ„:</strong> ${data.architecture}</p>
                    <p><strong>ç‰©ç†æ ¸å¿ƒ:</strong> ${data.physicalCores}</p>
                    <p><strong>é€»è¾‘æ ¸å¿ƒ:</strong> ${data.logicalCores}</p>
                    <p><strong>åŸºç?€é¢‘ç‡:</strong> ${data.baseFrequency} MHz</p>
                    ${data.maxFrequency ? `<p><strong>æœ€å¤§é?‘ç‡:</strong> ${data.maxFrequency} MHz</p>` : ''}
                `;
                
                document.getElementById('coreCount').textContent = data.physicalCores;
                document.getElementById('threadCount').textContent = data.logicalCores;
                document.getElementById('frequency').textContent = data.baseFrequency;
            } catch (error) {
                console.error('è·å–CPUä¿¡æ¯å¤±è´¥:', error);
            }
        }

        // æ›´æ–°CPUä½¿ç”¨ç?
        function updateCPUUsage() {
            fetch('/api/cpu/usage')
                .then(response => response.json())
                .then(data => {
                    const usage = data.usage.toFixed(1);
                    document.getElementById('usageText').textContent = usage + '%';
                    document.getElementById('usageBar').style.width = usage + '%';
                    document.getElementById('currentUsage').textContent = usage + '%';
                })
                .catch(error => console.error('è·å–CPUä½¿ç”¨ç‡å¤±è´?:', error));
        }

        // åŠ è½½ç£ç›˜ä¿¡æ¯
        async function loadDiskInfo() {
            try {
                const response = await fetch('/api/disk/info');
                const data = await response.json();
                
                diskData = data;
                document.getElementById('diskCount').textContent = `(${data.partitions ? data.partitions.length : 0} ä¸?åˆ†åŒº)`;
                
                displayPartitions(data.partitions || []);
                displayDrives(data.drives || []);
                
            } catch (error) {
                console.error('è·å–ç£ç›˜ä¿¡æ¯å¤±è´¥:', error);
                document.getElementById('partitionsTableBody').innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; color: #dc3545; padding: 20px;">
                            åŠ è½½å¤±è´¥: ${error.message}
                        </td>
                    </tr>
                `;
            }
            
            // åŠ è½½æ€§èƒ½æ•°æ®
            loadDiskPerformance();
        }

        // æ˜¾ç¤ºåˆ†åŒºä¿¡æ¯
        function displayPartitions(partitions) {
            const tbody = document.getElementById('partitionsTableBody');
            
            if (partitions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">
                            æ²¡æœ‰æ‰¾åˆ°åˆ†åŒºä¿¡æ¯
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = partitions.map(partition => {
                const usagePercentage = partition.usagePercentage || 0;
                const status = usagePercentage > 90 ? 'Warning' : 'Healthy';
                
                return `
                    <tr>
                        <td class="disk-drive-letter">${partition.driveLetter}</td>
                        <td>${partition.label || 'æ— å·æ ?'}</td>
                        <td class="disk-file-system">${partition.fileSystem || 'æœ?çŸ?'}</td>
                        <td class="disk-size">${formatBytes(partition.totalSize)}</td>
                        <td class="disk-size">${formatBytes(partition.usedSpace)}</td>
                        <td class="disk-size">${formatBytes(partition.freeSpace)}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="disk-usage-percent">${usagePercentage.toFixed(1)}%</span>
                                <div class="disk-usage-bar" style="flex: 1;">
                                    <div class="disk-usage-fill" style="width: ${usagePercentage}%"></div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="disk-status status-${status.toLowerCase()}">${status === 'Healthy' ? 'æ­£å¸¸' : 'è­¦å‘Š'}</span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // æ˜¾ç¤ºç£ç›˜é©±åŠ¨å™¨ä¿¡æ?
        function displayDrives(drives) {
            const tbody = document.getElementById('drivesTableBody');
            
            if (drives.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">
                            æ²¡æœ‰æ‰¾åˆ°ç£ç›˜é©±åŠ¨å™¨ä¿¡æ?
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = drives.map(drive => `
                <tr>
                    <td title="${drive.model}">${truncateText(drive.model, 25)}</td>
                    <td>${drive.serialNumber || 'æœ?çŸ?'}</td>
                    <td>${drive.interfaceType || 'æœ?çŸ?'}</td>
                    <td>${drive.mediaType || 'æœ?çŸ?'}</td>
                    <td class="disk-size">${formatBytes(drive.totalSize)}</td>
                    <td>${drive.bytesPerSector ? drive.bytesPerSector + ' å­—èŠ‚' : 'æœ?çŸ?'}</td>
                    <td>
                        <span class="disk-status status-healthy">${drive.status || 'æ­£å¸¸'}</span>
                    </td>
                    <td>${drive.deviceId || 'æœ?çŸ?'}</td>
                </tr>
            `).join('');
        }

        // åŠ è½½ç£ç›˜æ€§èƒ½æ•°æ®
        async function loadDiskPerformance() {
            try {
                const response = await fetch('/api/disk/performance');
                const data = await response.json();
                
                displayPerformance(data.performance || []);
            } catch (error) {
                console.error('è·å–ç£ç›˜æ€§èƒ½å¤±è´¥:', error);
                document.getElementById('performanceContent').innerHTML = `
                    <p style="text-align: center; color: #dc3545;">
                        åŠ è½½æ€§èƒ½æ•°æ®å¤±è´¥: ${error.message}
                    </p>
                `;
            }
        }

        // æ˜¾ç¤ºæ€§èƒ½æ•°æ®
        function displayPerformance(performance) {
            const container = document.getElementById('performanceContent');
            
            if (performance.length === 0) {
                container.innerHTML = `
                    <p style="text-align: center; padding: 20px;">
                        æ²¡æœ‰æ€§èƒ½æ•°æ®å?ç”?
                    </p>
                `;
                return;
            }
            
            container.innerHTML = performance.map(perf => `
                <div style="margin-bottom: 20px;">
                    <h4>${perf.driveLetter === '_Total' ? 'æ€»ä½“ç£ç›˜æ€§èƒ½' : 'ç£ç›˜ ' + perf.driveLetter}</h4>
                    <div class="performance-grid">
                        <div class="performance-card">
                            <div class="performance-value">${perf.readSpeed ? perf.readSpeed.toFixed(2) : '0'} MB/s</div>
                            <div class="performance-label">è¯»å–é€Ÿåº¦</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${perf.writeSpeed ? perf.writeSpeed.toFixed(2) : '0'} MB/s</div>
                            <div class="performance-label">å†™å…¥é€Ÿåº¦</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${perf.usagePercentage ? perf.usagePercentage.toFixed(1) : '0'}%</div>
                            <div class="performance-label">ç£ç›˜ä½¿ç”¨ç?</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${perf.queueLength ? perf.queueLength.toFixed(2) : '0'}</div>
                            <div class="performance-label">é˜Ÿåˆ—é•¿åº¦</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${formatBytes(perf.readBytesPerSec || 0)}/s</div>
                            <div class="performance-label">è¯»å–å­—èŠ‚æ•?</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${formatBytes(perf.writeBytesPerSec || 0)}/s</div>
                            <div class="performance-label">å†™å…¥å­—èŠ‚æ•?</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // åˆ‡æ¢ç£ç›˜æ ‡ç?¾é¡µ
        function switchDiskTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å??
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€?
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µå†…å??
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­?
            event.target.classList.add('active');
        }

        // åˆ‡æ¢ç£ç›˜åˆ—è¡¨æ˜¾ç¤º/éšè—
        function toggleDiskList() {
            const diskList = document.getElementById('diskList');
            const card = diskList.closest('.card');
            card.classList.toggle('collapsed');
        }

        // æ ¼å¼åŒ–å­—èŠ‚å¤§å°?
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // æˆ?æ–?æ–‡æœ¬
        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // è¿›ç¨‹ç›¸å…³å‡½æ•°ï¼ˆä¿æŒä¸å˜ï¼‰
        async function loadProcesses() {
            try {
                const response = await fetch('/api/processes');
                const data = await response.json();
                
                allProcesses = data.processes || [];
                document.getElementById('processCount').textContent = `(${allProcesses.length} ä¸?è¿›ç¨‹)`;
                
                sortAndDisplayProcesses();
            } catch (error) {
                console.error('è·å–è¿›ç¨‹åˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('processTableBody').innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; color: #dc3545; padding: 20px;">
                            åŠ è½½å¤±è´¥: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        function sortAndDisplayProcesses() {
            const sortedProcesses = [...allProcesses];
            
            switch (currentSort) {
                case 'name':
                    sortedProcesses.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'cpu':
                    sortedProcesses.sort((a, b) => b.cpuUsage - a.cpuUsage);
                    break;
                case 'memory':
                    sortedProcesses.sort((a, b) => b.memoryUsage - a.memoryUsage);
                    break;
                case 'pid':
                    sortedProcesses.sort((a, b) => a.pid - b.pid);
                    break;
            }
            
            const displayProcesses = showAllProcesses ? sortedProcesses : sortedProcesses.slice(0, 20);
            displayProcessList(displayProcesses);
        }

        function displayProcessList(processes) {
            const tbody = document.getElementById('processTableBody');
            
            if (processes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">
                            æ²¡æœ‰æ‰¾åˆ°è¿›ç¨‹ä¿¡æ¯
                        </td>
                    </tr>
                `;
                return;
            }
            
            const validProcesses = processes.map(process => {
                let cpuUsage = process.cpuUsage;
                if (!isFinite(cpuUsage) || cpuUsage < 0 || cpuUsage > 100) {
                    cpuUsage = 0;
                }
                
                return {
                    ...process,
                    cpuUsage: cpuUsage
                };
            });
            
            tbody.innerHTML = validProcesses.map(process => `
                <tr>
                    <td class="process-pid">${process.pid}</td>
                    <td class="process-name" title="${process.name}">${process.name}</td>
                    <td class="process-cpu">${process.cpuUsage.toFixed(1)}%</td>
                    <td class="process-memory">${formatBytes(process.memoryUsage)}</td>
                    <td>${process.threadCount}</td>
                    <td class="process-user" title="${process.username}">${process.username}</td>
                    <td>
                        <span class="process-state state-running">${process.state}</span>
                    </td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" 
                        title="${process.fullPath || ''}">
                        ${process.fullPath || 'N/A'}
                    </td>
                </tr>
            `).join('');
        }

        function sortProcesses() {
            currentSort = document.getElementById('sortSelect').value;
            sortAndDisplayProcesses();
        }

        function toggleProcessList() {
            const processList = document.getElementById('processList');
            const card = processList.closest('.card');
            card.classList.toggle('collapsed');
        }

        function toggleAllProcesses() {
            showAllProcesses = !showAllProcesses;
            const button = document.querySelector('.show-all-btn');
            button.textContent = showAllProcesses ? 'æ˜¾ç¤ºå‰?20ä¸?è¿›ç¨‹' : 'æ˜¾ç¤ºå…¨éƒ¨è¿›ç¨‹';
            sortAndDisplayProcesses();
        }

        // // ¼ÓÔØ´ÅÅÌĞÅÏ¢
        // async function loadDiskInfo() {
        //     try {
        //         console.log('¿ªÊ¼ÇëÇó´ÅÅÌĞÅÏ¢...');
        //         const response = await fetch('/api/disk/info');
                
        //         if (!response.ok) {
        //             throw new Error(`HTTP´íÎó: ${response.status} ${response.statusText}`);
        //         }
                
        //         const data = await response.json();
        //         console.log('´ÅÅÌAPIÏìÓ¦:', data);
                
        //         diskData = data;
        //         document.getElementById('diskCount').textContent = `(${data.partitions ? data.partitions.length : 0} ¸ö·ÖÇø)`;
                
        //         displayPartitions(data.partitions || []);
        //         displayDrives(data.drives || []);
                
        //     } catch (error) {
        //         console.error('»ñÈ¡´ÅÅÌĞÅÏ¢Ê§°Ü:', error);
        //         document.getElementById('partitionsTableBody').innerHTML = `
        //             <tr>
        //                 <td colspan="8" style="text-align: center; color: #dc3545; padding: 20px;">
        //                     ¼ÓÔØÊ§°Ü: ${error.message}
        //                 </td>
        //             </tr>
        //         `;
        //     }
            
        //     // ¼ÓÔØĞÔÄÜÊı¾İ
        //     loadDiskPerformance();
        // }

        // // ¼ÓÔØ´ÅÅÌĞÔÄÜÊı¾İ
        // async function loadDiskPerformance() {
        //     try {
        //         console.log('¿ªÊ¼ÇëÇó´ÅÅÌĞÔÄÜÊı¾İ...');
        //         const response = await fetch('/api/disk/performance');
                
        //         if (!response.ok) {
        //             throw new Error(`HTTP´íÎó: ${response.status} ${response.statusText}`);
        //         }
                
        //         const data = await response.json();
        //         console.log('´ÅÅÌĞÔÄÜAPIÏìÓ¦:', data);
                
        //         displayPerformance(data.performance || []);
        //     } catch (error) {
        //         console.error('»ñÈ¡´ÅÅÌĞÔÄÜÊ§°Ü:', error);
        //         document.getElementById('performanceContent').innerHTML = `
        //             <p style="text-align: center; color: #dc3545;">
        //                 ¼ÓÔØĞÔÄÜÊı¾İÊ§°Ü: ${error.message}
        //             </p>
        //         `;
        //     }
        // }

        // åˆå?‹åŒ–
        fetchCPUInfo();
        updateCPUUsage();
        loadProcesses();
        loadDiskInfo();
        
        // å®šæ—¶æ›´æ–°
        setInterval(updateCPUUsage, 1000);
        setInterval(fetchCPUInfo, 30000);
        setInterval(loadProcesses, 5000);
        setInterval(loadDiskInfo, 10000); // 10ç§’æ›´æ–°ä¸€æ¬¡ç?ç›˜ä¿¡æ¯
    </script>
</body>
</html>