<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿç›‘æ§é¢æ¿</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .usage-meter {
            width: 100%;
            height: 30px;
            background-color: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        .usage-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #FFC107, #F44336);
            transition: width 0.5s ease;
        }
        .disk-usage-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }
        .disk-usage-fill {
            height: 100%;
            background: linear-gradient(90deg, #2196F3, #03A9F4);
            transition: width 0.5s ease;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2196F3;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        /* è¿›ç¨‹åˆ—è¡¨æ ·å¼ */
        .process-header, .disk-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .process-header:hover, .disk-header:hover {
            background: #e9ecef;
        }
        .process-controls, .disk-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .sort-select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        .refresh-btn {
            padding: 5px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .refresh-btn:hover {
            background: #0056b3;
        }
        .process-list, .disk-list {
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .process-table, .disk-table {
            width: 100%;
            border-collapse: collapse;
        }
        .process-table th, .disk-table th {
            background: #f8f9fa;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
        }
        .process-table td, .disk-table td {
            padding: 8px;
            border-bottom: 1px solid #e0e0e0;
        }
        .process-table tr:hover, .disk-table tr:hover {
            background: #f8f9fa;
        }
        .process-name {
            font-weight: 500;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .process-pid {
            color: #666;
            font-family: monospace;
        }
        .process-cpu {
            color: #e74c3c;
            font-weight: 500;
        }
        .process-memory {
            color: #3498db;
            font-weight: 500;
        }
        .process-user {
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .process-state {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .state-running {
            background: #d4edda;
            color: #155724;
        }
        .collapsed .process-list, .collapsed .disk-list {
            display: none;
        }
        .toggle-icon {
            transition: transform 0.3s ease;
        }
        .collapsed .toggle-icon {
            transform: rotate(-90deg);
        }
        .show-all-btn {
            width: 100%;
            padding: 10px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        .show-all-btn:hover {
            background: #545b62;
        }
        
        /* ç£ç›˜ä¿¡æ¯æ ·å¼ */
        .disk-drive-letter {
            font-weight: bold;
            color: #2196F3;
            font-size: 16px;
        }
        .disk-usage-percent {
            font-weight: bold;
            color: #e74c3c;
        }
        .disk-size {
            color: #666;
            font-family: monospace;
        }
        .disk-file-system {
            color: #27ae60;
            font-weight: 500;
        }
        .disk-status {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-healthy {
            background: #d4edda;
            color: #155724;
        }
        .status-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        /* æ€§èƒ½æŒ‡æ ‡æ ·å¼ */
        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .performance-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        .performance-value {
            font-size: 20px;
            font-weight: bold;
            color: #2196F3;
        }
        .performance-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        /* é€‰é¡¹å¡æ ·å¼ */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background: white;
            border-color: #ddd;
            border-bottom-color: white;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        /* æ³¨å†Œè¡¨ç›‘æ§æ ·å¼ */
        .registry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .registry-header:hover {
            background: #e9ecef;
        }
        .registry-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .registry-section {
            max-height: 800px;
            overflow-y: auto;
        }
        .collapsed .registry-section {
            display: none;
        }

        /* å¿«ç…§ç®¡ç†æ ·å¼ */
        .snapshot-management {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .snapshot-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }
        .snapshots-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .snapshot-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .snapshot-item:hover {
            border-color: #007bff;
        }
        .snapshot-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .snapshot-meta {
            font-size: 12px;
            color: #666;
        }
        .snapshot-actions {
            margin-top: 5px;
        }
        .btn-primary {
            background: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .snapshot-select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
        }

        /* æ¯”è¾ƒç»“æœæ ·å¼ */
        .comparison-result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .change-added {
            color: #28a745;
            font-weight: bold;
        }
        .change-removed {
            color: #dc3545;
            font-weight: bold;
        }
        .change-modified {
            color: #ffc107;
            font-weight: bold;
        }

        /* æ³¨å†Œè¡¨å†…å®¹æ ·å¼ */
        .registry-content {
            max-height: 400px;
            overflow-y: auto;
        }
        .registry-key {
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        .registry-key-header {
            background: #f8f9fa;
            padding: 10px;
            font-weight: bold;
            cursor: pointer;
            border-bottom: 1px solid #e0e0e0;
        }
        .registry-key-content {
            padding: 10px;
            background: white;
        }
        .registry-value {
            display: flex;
            margin-bottom: 5px;
            padding: 5px;
            border-bottom: 1px solid #f0f0f0;
        }
        .registry-value-name {
            font-weight: bold;
            min-width: 150px;
        }
        .registry-value-type {
            color: #6c757d;
            min-width: 80px;
            font-size: 12px;
        }
        .registry-value-data {
            flex: 1;
            word-break: break-all;
        }

        /* é©±åŠ¨ä¿¡æ¯æ ·å¼ */
        .driver-state {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .state-running {
            background: #d4edda;
            color: #155724;
        }

        .state-stopped {
            background: #f8d7da;
            color: #721c24;
        }

        .state-pending {
            background: #fff3cd;
            color: #856404;
        }

        .state-unknown {
            background: #e2e3e5;
            color: #383d41;
        }

        /* é©±åŠ¨è¡¨æ ¼ç‰¹å®šæ ·å¼ */
        #driverList .process-table {
            font-size: 12px;
        }

        #driverList .process-table th {
            padding: 8px 4px;
            font-size: 11px;
        }

        #driverList .process-table td {
            padding: 6px 4px;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–¥ï¸ ç³»ç»Ÿç›‘æ§é¢æ¿</h1>
        
        <div class="card">
            <h2>CPUä½¿ç”¨ç‡</h2>
            <div class="usage-meter">
                <div id="usageBar" class="usage-bar" style="width: 0%"></div>
            </div>
            <div id="usageText" style="text-align: center; font-size: 24px; font-weight: bold;">0%</div>
        </div>

        <div class="card">
            <h2>CPUä¿¡æ¯</h2>
            <div id="cpuInfo">
                <p>åŠ è½½ä¸­...</p>
            </div>
        </div>

        <div class="card">
            <h2>å®æ—¶æ•°æ®</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="currentUsage">0%</div>
                    <div class="stat-label">å½“å‰ä½¿ç”¨ç‡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="coreCount">0</div>
                    <div class="stat-label">ç‰©ç†æ ¸å¿ƒ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="threadCount">0</div>
                    <div class="stat-label">é€»è¾‘æ ¸å¿ƒ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="frequency">0</div>
                    <div class="stat-label">åŸºç¡€é¢‘ç‡ (MHz)</div>
                </div>
            </div>
        </div>

        <!-- ç£ç›˜ä¿¡æ¯çª—å£ -->
        <div class="card">
            <div class="disk-header" onclick="toggleDiskList()">
                <h2 style="margin: 0;">ç£ç›˜ä¿¡æ¯ 
                    <span id="diskCount" style="font-size: 14px; color: #666; margin-left: 10px;"></span>
                </h2>
                <div class="disk-controls" onclick="event.stopPropagation()">
                    <button class="refresh-btn" onclick="loadDiskInfo()">åˆ·æ–°</button>
                    <span class="toggle-icon">â–¼</span>
                </div>
            </div>
            
            <div id="diskList" class="disk-list">
                <!-- é€‰é¡¹å¡ -->
                <div class="tabs">
                    <div class="tab active" onclick="switchDiskTab('partitions')">åˆ†åŒºä¿¡æ¯</div>
                    <div class="tab" onclick="switchDiskTab('performance')">æ€§èƒ½ç›‘æ§</div>
                    <div class="tab" onclick="switchDiskTab('drives')">ç£ç›˜é©±åŠ¨å™¨</div>
                </div>
                
                <!-- åˆ†åŒºä¿¡æ¯æ ‡ç­¾é¡µ -->
                <div id="partitionsTab" class="tab-content active">
                    <table class="disk-table">
                        <thead>
                            <tr>
                                <th width="8%">ç›˜ç¬¦</th>
                                <th width="15%">å·æ ‡</th>
                                <th width="12%">æ–‡ä»¶ç³»ç»Ÿ</th>
                                <th width="15%">æ€»ç©ºé—´</th>
                                <th width="15%">å·²ç”¨ç©ºé—´</th>
                                <th width="15%">å¯ç”¨ç©ºé—´</th>
                                <th width="10%">ä½¿ç”¨ç‡</th>
                                <th width="10%">çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody id="partitionsTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 20px;">
                                    åŠ è½½ä¸­...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- æ€§èƒ½ç›‘æ§æ ‡ç­¾é¡µ -->
                <div id="performanceTab" class="tab-content">
                    <div id="performanceContent">
                        <p style="text-align: center; padding: 20px;">åŠ è½½ä¸­...</p>
                    </div>
                </div>
                
                <!-- ç£ç›˜é©±åŠ¨å™¨æ ‡ç­¾é¡µ -->
                <div id="drivesTab" class="tab-content">
                    <table class="disk-table">
                        <thead>
                            <tr>
                                <th width="20%">å‹å·</th>
                                <th width="15%">åºåˆ—å·</th>
                                <th width="10%">æ¥å£ç±»å‹</th>
                                <th width="10%">ä»‹è´¨ç±»å‹</th>
                                <th width="15%">æ€»å®¹é‡</th>
                                <th width="10%">æ‰‡åŒºå¤§å°</th>
                                <th width="10%">çŠ¶æ€</th>
                                <th width="10%">è®¾å¤‡ID</th>
                            </tr>
                        </thead>
                        <tbody id="drivesTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 20px;">
                                    åŠ è½½ä¸­...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- è¿›ç¨‹ä¿¡æ¯çª—å£ -->
        <div class="card">
            <div class="process-header" onclick="toggleProcessList()">
                <h2 style="margin: 0;">è¿›ç¨‹ä¿¡æ¯ 
                    <span id="processCount" style="font-size: 14px; color: #666; margin-left: 10px;"></span>
                </h2>
                <div class="process-controls" onclick="event.stopPropagation()">
                    <span>æ’åºæ–¹å¼:</span>
                    <select class="sort-select" id="sortSelect" onchange="sortProcesses()">
                        <option value="name">è¿›ç¨‹åç§°</option>
                        <option value="cpu">CPUå ç”¨ç‡</option>
                        <option value="memory">å†…å­˜å ç”¨</option>
                        <option value="pid">è¿›ç¨‹ID</option>
                    </select>
                    <button class="refresh-btn" onclick="loadProcesses()">åˆ·æ–°</button>
                    <span class="toggle-icon">â–¼</span>
                </div>
            </div>
            
            <div id="processList" class="process-list">
                <table class="process-table">
                    <thead>
                        <tr>
                            <th width="5%">PID</th>
                            <th width="20%">è¿›ç¨‹åç§°</th>
                            <th width="10%">CPU</th>
                            <th width="15%">å†…å­˜</th>
                            <th width="10%">çº¿ç¨‹</th>
                            <th width="15%">ç”¨æˆ·å</th>
                            <th width="10%">çŠ¶æ€</th>
                            <th width="15%">è·¯å¾„</th>
                        </tr>
                    </thead>
                    <tbody id="processTableBody">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 20px;">
                                åŠ è½½ä¸­...
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button class="show-all-btn" onclick="toggleAllProcesses()">æ˜¾ç¤ºå…¨éƒ¨è¿›ç¨‹</button>
            </div>
        </div>

        <!-- æ³¨å†Œè¡¨ç›‘æ§çª—å£ -->
        <div class="card">
            <div class="registry-header" onclick="toggleRegistrySection()">
                <h2 style="margin: 0;">æ³¨å†Œè¡¨ç›‘æ§ 
                    <span id="registrySnapshotCount" style="font-size: 14px; color: #666; margin-left: 10px;"></span>
                </h2>
                <div class="registry-controls" onclick="event.stopPropagation()">
                    <button class="refresh-btn" onclick="loadRegistrySnapshot()">åˆ·æ–°å¿«ç…§</button>
                    <button class="refresh-btn" onclick="saveRegistrySnapshot()">ä¿å­˜å¿«ç…§</button>
                    <span class="toggle-icon">â–¼</span>
                </div>
            </div>
            
            <div id="registrySection" class="registry-section">
                <!-- å¿«ç…§ç®¡ç† -->
                <div class="snapshot-management">
                    <h3>å¿«ç…§ç®¡ç†</h3>
                    <div class="snapshot-controls">
                        <input type="text" id="snapshotName" placeholder="å¿«ç…§åç§°" style="padding: 5px; margin-right: 10px;">
                        <button class="btn-primary" onclick="saveRegistrySnapshot()">ä¿å­˜å½“å‰å¿«ç…§</button>
                        <button class="btn-secondary" onclick="loadSavedSnapshots()">åˆ·æ–°å¿«ç…§åˆ—è¡¨</button>
                    </div>
                    
                    <div class="snapshot-list">
                        <h4>å·²ä¿å­˜çš„å¿«ç…§</h4>
                        <div id="savedSnapshotsList" class="snapshots-container">
                            <!-- å¿«ç…§åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div class="snapshot-comparison">
                        <h4>å¿«ç…§æ¯”è¾ƒ</h4>
                        <div class="comparison-controls">
                            <select id="compareSnapshot1" class="snapshot-select">
                                <option value="">é€‰æ‹©ç¬¬ä¸€ä¸ªå¿«ç…§</option>
                            </select>
                            <select id="compareSnapshot2" class="snapshot-select">
                                <option value="">é€‰æ‹©ç¬¬äºŒä¸ªå¿«ç…§</option>
                            </select>
                            <button class="btn-primary" onclick="compareSnapshots()">æ¯”è¾ƒå¿«ç…§</button>
                        </div>
                        <div id="comparisonResult" class="comparison-result">
                            <!-- æ¯”è¾ƒç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>
                </div>
                
                <!-- å½“å‰å¿«ç…§è¯¦æƒ… -->
                <div class="current-snapshot">
                    <h3>å½“å‰æ³¨å†Œè¡¨å¿«ç…§</h3>
                    <div class="tabs">
                        <div class="tab active" onclick="switchRegistryTab('systemInfo')">ç³»ç»Ÿä¿¡æ¯</div>
                        <div class="tab" onclick="switchRegistryTab('software')">è½¯ä»¶ä¿¡æ¯</div>
                        <div class="tab" onclick="switchRegistryTab('network')">ç½‘ç»œé…ç½®</div>
                    </div>
                    
                    <div id="systemInfoTab" class="tab-content active">
                        <div id="systemInfoContent" class="registry-content">
                            <!-- ç³»ç»Ÿä¿¡æ¯å†…å®¹ -->
                        </div>
                    </div>
                    
                    <div id="softwareTab" class="tab-content">
                        <div id="softwareContent" class="registry-content">
                            <!-- è½¯ä»¶ä¿¡æ¯å†…å®¹ -->
                        </div>
                    </div>
                    
                    <div id="networkTab" class="tab-content">
                        <div id="networkContent" class="registry-content">
                            <!-- ç½‘ç»œé…ç½®å†…å®¹ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é©±åŠ¨ä¿¡æ¯çª—å£ -->
<div class="card">
    <div class="process-header" onclick="toggleDriverList()">
        <h2 style="margin: 0;">é©±åŠ¨ä¿¡æ¯ 
            <span id="driverCount" style="font-size: 14px; color: #666; margin-left: 10px;"></span>
        </h2>
        <div class="process-controls" onclick="event.stopPropagation()">
            <span>æ’åºæ–¹å¼:</span>
            <select class="sort-select" id="driverSortSelect" onchange="sortDrivers()">
                <option value="name">é©±åŠ¨åç§°</option>
                <option value="state">çŠ¶æ€</option>
                <option value="type">ç±»å‹</option>
                <option value="startType">å¯åŠ¨ç±»å‹</option>
            </select>
            <button class="refresh-btn" onclick="loadDriverInfo()">åˆ·æ–°</button>
            <span class="toggle-icon">â–¼</span>
        </div>
    </div>
    
    <div id="driverList" class="process-list">
        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="stats-grid" id="driverStats" style="margin: 15px 0;">
            <!-- ç»Ÿè®¡ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <!-- é€‰é¡¹å¡ -->
        <div class="tabs">
            <div class="tab active" onclick="switchDriverTab('all')">å…¨éƒ¨é©±åŠ¨</div>
            <div class="tab" onclick="switchDriverTab('running')">è¿è¡Œä¸­</div>
            <div class="tab" onclick="switchDriverTab('kernel')">å†…æ ¸é©±åŠ¨</div>
            <div class="tab" onclick="switchDriverTab('filesystem')">æ–‡ä»¶ç³»ç»Ÿ</div>
            <div class="tab" onclick="switchDriverTab('autostart')">è‡ªåŠ¨å¯åŠ¨</div>
            <div class="tab" onclick="switchDriverTab('thirdparty')">ç¬¬ä¸‰æ–¹é©±åŠ¨</div>
        </div>
        
        <!-- å…¨éƒ¨é©±åŠ¨æ ‡ç­¾é¡µ -->
        <div id="allTab" class="tab-content active">
            <table class="process-table">
                <thead>
                    <tr>
                        <th width="15%">é©±åŠ¨åç§°</th>
                        <th width="20%">æ˜¾ç¤ºåç§°</th>
                        <th width="10%">çŠ¶æ€</th>
                        <th width="10%">ç±»å‹</th>
                        <th width="10%">å¯åŠ¨ç±»å‹</th>
                        <th width="15%">æ–‡ä»¶è·¯å¾„</th>
                        <th width="10%">PID</th>
                        <th width="10%">é”™è¯¯æ§åˆ¶</th>
                    </tr>
                </thead>
                <tbody id="allDriversTableBody">
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">
                            åŠ è½½ä¸­...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- è¿è¡Œä¸­é©±åŠ¨æ ‡ç­¾é¡µ -->
        <div id="runningTab" class="tab-content">
            <table class="process-table">
                <thead>
                    <tr>
                        <th width="15%">é©±åŠ¨åç§°</th>
                        <th width="20%">æ˜¾ç¤ºåç§°</th>
                        <th width="10%">PID</th>
                        <th width="15%">æ–‡ä»¶è·¯å¾„</th>
                        <th width="10%">å¯åŠ¨ç±»å‹</th>
                        <th width="10%">ç±»å‹</th>
                        <th width="20%">æè¿°</th>
                    </tr>
                </thead>
                <tbody id="runningDriversTableBody">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">
                            åŠ è½½ä¸­...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- å†…æ ¸é©±åŠ¨æ ‡ç­¾é¡µ -->
        <div id="kernelTab" class="tab-content">
            <table class="process-table">
                <thead>
                    <tr>
                        <th width="15%">é©±åŠ¨åç§°</th>
                        <th width="20%">æ˜¾ç¤ºåç§°</th>
                        <th width="10%">çŠ¶æ€</th>
                        <th width="10%">å¯åŠ¨ç±»å‹</th>
                        <th width="15%">æ–‡ä»¶è·¯å¾„</th>
                        <th width="10%">é”™è¯¯æ§åˆ¶</th>
                        <th width="20%">æè¿°</th>
                    </tr>
                </thead>
                <tbody id="kernelDriversTableBody">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">
                            åŠ è½½ä¸­...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨æ ‡ç­¾é¡µ -->
        <div id="filesystemTab" class="tab-content">
            <table class="process-table">
                <thead>
                    <tr>
                        <th width="15%">é©±åŠ¨åç§°</th>
                        <th width="20%">æ˜¾ç¤ºåç§°</th>
                        <th width="10%">çŠ¶æ€</th>
                        <th width="10%">å¯åŠ¨ç±»å‹</th>
                        <th width="15%">æ–‡ä»¶è·¯å¾„</th>
                        <th width="10%">é”™è¯¯æ§åˆ¶</th>
                        <th width="20%">æè¿°</th>
                    </tr>
                </thead>
                <tbody id="filesystemDriversTableBody">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">
                            åŠ è½½ä¸­...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- è‡ªåŠ¨å¯åŠ¨é©±åŠ¨æ ‡ç­¾é¡µ -->
        <div id="autostartTab" class="tab-content">
            <table class="process-table">
                <thead>
                    <tr>
                        <th width="15%">é©±åŠ¨åç§°</th>
                        <th width="20%">æ˜¾ç¤ºåç§°</th>
                        <th width="10%">çŠ¶æ€</th>
                        <th width="10%">å¯åŠ¨ç±»å‹</th>
                        <th width="15%">æ–‡ä»¶è·¯å¾„</th>
                        <th width="10%">ç±»å‹</th>
                        <th width="20%">æè¿°</th>
                    </tr>
                </thead>
                <tbody id="autostartDriversTableBody">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">
                            åŠ è½½ä¸­...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- ç¬¬ä¸‰æ–¹é©±åŠ¨æ ‡ç­¾é¡µ -->
        <div id="thirdpartyTab" class="tab-content">
            <table class="process-table">
                <thead>
                    <tr>
                        <th width="15%">é©±åŠ¨åç§°</th>
                        <th width="20%">æ˜¾ç¤ºåç§°</th>
                        <th width="10%">çŠ¶æ€</th>
                        <th width="10%">å¯åŠ¨ç±»å‹</th>
                        <th width="25%">æ–‡ä»¶è·¯å¾„</th>
                        <th width="10%">ç±»å‹</th>
                        <th width="10%">PID</th>
                    </tr>
                </thead>
                <tbody id="thirdpartyDriversTableBody">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">
                            åŠ è½½ä¸­...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <button class="show-all-btn" onclick="toggleAllDrivers()">æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</button>
    </div>
</div>

    </div>

    <script>
        // å…¨å±€å˜é‡
        let allProcesses = [];
        let showAllProcesses = false;
        let currentSort = 'name';
        let diskData = {};

        // è·å–CPUä¿¡æ¯
        async function fetchCPUInfo() {
            try {
                const response = await fetch('/api/cpu/info');
                const data = await response.json();
                
                document.getElementById('cpuInfo').innerHTML = `
                    <p><strong>åç§°:</strong> ${data.name}</p>
                    <p><strong>æ¶æ„:</strong> ${data.architecture}</p>
                    <p><strong>ç‰©ç†æ ¸å¿ƒ:</strong> ${data.physicalCores}</p>
                    <p><strong>é€»è¾‘æ ¸å¿ƒ:</strong> ${data.logicalCores}</p>
                    <p><strong>åŸºç¡€é¢‘ç‡:</strong> ${data.baseFrequency} MHz</p>
                    ${data.maxFrequency ? `<p><strong>æœ€å¤§é¢‘ç‡:</strong> ${data.maxFrequency} MHz</p>` : ''}
                `;
                
                document.getElementById('coreCount').textContent = data.physicalCores;
                document.getElementById('threadCount').textContent = data.logicalCores;
                document.getElementById('frequency').textContent = data.baseFrequency;
            } catch (error) {
                console.error('è·å–CPUä¿¡æ¯å¤±è´¥:', error);
            }
        }

        // æ›´æ–°CPUä½¿ç”¨ç‡
        function updateCPUUsage() {
            fetch('/api/cpu/usage')
                .then(response => response.json())
                .then(data => {
                    const usage = data.usage.toFixed(1);
                    document.getElementById('usageText').textContent = usage + '%';
                    document.getElementById('usageBar').style.width = usage + '%';
                    document.getElementById('currentUsage').textContent = usage + '%';
                })
                .catch(error => console.error('è·å–CPUä½¿ç”¨ç‡å¤±è´¥:', error));
        }

        // åŠ è½½ç£ç›˜ä¿¡æ¯
        async function loadDiskInfo() {
            try {
                const response = await fetch('/api/disk/info');
                const data = await response.json();
                
                diskData = data;
                document.getElementById('diskCount').textContent = `(${data.partitions ? data.partitions.length : 0} ä¸ªåˆ†åŒº)`;
                
                displayPartitions(data.partitions || []);
                displayDrives(data.drives || []);
                
            } catch (error) {
                console.error('è·å–ç£ç›˜ä¿¡æ¯å¤±è´¥:', error);
                document.getElementById('partitionsTableBody').innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; color: #dc3545; padding: 20px;">
                            åŠ è½½å¤±è´¥: ${error.message}
                        </td>
                    </tr>
                `;
            }
            
            // åŠ è½½æ€§èƒ½æ•°æ®
            loadDiskPerformance();
        }

        // æ˜¾ç¤ºåˆ†åŒºä¿¡æ¯
        function displayPartitions(partitions) {
            const tbody = document.getElementById('partitionsTableBody');
            
            if (partitions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">
                            æ²¡æœ‰æ‰¾åˆ°åˆ†åŒºä¿¡æ¯
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = partitions.map(partition => {
                const usagePercentage = partition.usagePercentage || 0;
                const status = usagePercentage > 90 ? 'Warning' : 'Healthy';
                
                return `
                    <tr>
                        <td class="disk-drive-letter">${partition.driveLetter}</td>
                        <td>${partition.label || 'æ— å·æ ‡'}</td>
                        <td class="disk-file-system">${partition.fileSystem || 'æœªçŸ¥'}</td>
                        <td class="disk-size">${formatBytes(partition.totalSize)}</td>
                        <td class="disk-size">${formatBytes(partition.usedSpace)}</td>
                        <td class="disk-size">${formatBytes(partition.freeSpace)}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="disk-usage-percent">${usagePercentage.toFixed(1)}%</span>
                                <div class="disk-usage-bar" style="flex: 1;">
                                    <div class="disk-usage-fill" style="width: ${usagePercentage}%"></div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="disk-status status-${status.toLowerCase()}">${status === 'Healthy' ? 'æ­£å¸¸' : 'è­¦å‘Š'}</span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // æ˜¾ç¤ºç£ç›˜é©±åŠ¨å™¨ä¿¡æ¯
        function displayDrives(drives) {
            const tbody = document.getElementById('drivesTableBody');
            
            if (drives.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">
                            æ²¡æœ‰æ‰¾åˆ°ç£ç›˜é©±åŠ¨å™¨ä¿¡æ¯
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = drives.map(drive => `
                <tr>
                    <td title="${drive.model}">${truncateText(drive.model, 25)}</td>
                    <td>${drive.serialNumber || 'æœªçŸ¥'}</td>
                    <td>${drive.interfaceType || 'æœªçŸ¥'}</td>
                    <td>${drive.mediaType || 'æœªçŸ¥'}</td>
                    <td class="disk-size">${formatBytes(drive.totalSize)}</td>
                    <td>${drive.bytesPerSector ? drive.bytesPerSector + ' å­—èŠ‚' : 'æœªçŸ¥'}</td>
                    <td>
                        <span class="disk-status status-healthy">${drive.status || 'æ­£å¸¸'}</span>
                    </td>
                    <td>${drive.deviceId || 'æœªçŸ¥'}</td>
                </tr>
            `).join('');
        }

        // åŠ è½½ç£ç›˜æ€§èƒ½æ•°æ®
        async function loadDiskPerformance() {
            try {
                const response = await fetch('/api/disk/performance');
                const data = await response.json();
                
                displayPerformance(data.performance || []);
            } catch (error) {
                console.error('è·å–ç£ç›˜æ€§èƒ½å¤±è´¥:', error);
                document.getElementById('performanceContent').innerHTML = `
                    <p style="text-align: center; color: #dc3545;">
                        åŠ è½½æ€§èƒ½æ•°æ®å¤±è´¥: ${error.message}
                    </p>
                `;
            }
        }

        // æ˜¾ç¤ºæ€§èƒ½æ•°æ®
        function displayPerformance(performance) {
            const container = document.getElementById('performanceContent');
            
            if (performance.length === 0) {
                container.innerHTML = `
                    <p style="text-align: center; padding: 20px;">
                        æ²¡æœ‰æ€§èƒ½æ•°æ®å¯ç”¨
                    </p>
                `;
                return;
            }
            
            container.innerHTML = performance.map(perf => `
                <div style="margin-bottom: 20px;">
                    <h4>${perf.driveLetter === '_Total' ? 'æ€»ä½“ç£ç›˜æ€§èƒ½' : 'ç£ç›˜ ' + perf.driveLetter}</h4>
                    <div class="performance-grid">
                        <div class="performance-card">
                            <div class="performance-value">${perf.readSpeed ? perf.readSpeed.toFixed(2) : '0'} MB/s</div>
                            <div class="performance-label">è¯»å–é€Ÿåº¦</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${perf.writeSpeed ? perf.writeSpeed.toFixed(2) : '0'} MB/s</div>
                            <div class="performance-label">å†™å…¥é€Ÿåº¦</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${perf.usagePercentage ? perf.usagePercentage.toFixed(1) : '0'}%</div>
                            <div class="performance-label">ç£ç›˜ä½¿ç”¨ç‡</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${perf.queueLength ? perf.queueLength.toFixed(2) : '0'}</div>
                            <div class="performance-label">é˜Ÿåˆ—é•¿åº¦</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${formatBytes(perf.readBytesPerSec || 0)}/s</div>
                            <div class="performance-label">è¯»å–å­—èŠ‚æ•°</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${formatBytes(perf.writeBytesPerSec || 0)}/s</div>
                            <div class="performance-label">å†™å…¥å­—èŠ‚æ•°</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // åˆ‡æ¢ç£ç›˜æ ‡ç­¾é¡µ
        function switchDiskTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µå†…å®¹
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­¾
            event.target.classList.add('active');
        }

        // åˆ‡æ¢ç£ç›˜åˆ—è¡¨æ˜¾ç¤º/éšè—
        function toggleDiskList() {
            const diskList = document.getElementById('diskList');
            const card = diskList.closest('.card');
            card.classList.toggle('collapsed');
        }

        // æ ¼å¼åŒ–å­—èŠ‚å¤§å°
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // æˆªæ–­æ–‡æœ¬
        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // è¿›ç¨‹ç›¸å…³å‡½æ•°
        async function loadProcesses() {
            try {
                const response = await fetch('/api/processes');
                const data = await response.json();
                
                allProcesses = data.processes || [];
                document.getElementById('processCount').textContent = `(${allProcesses.length} ä¸ªè¿›ç¨‹)`;
                
                sortAndDisplayProcesses();
            } catch (error) {
                console.error('è·å–è¿›ç¨‹åˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('processTableBody').innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; color: #dc3545; padding: 20px;">
                            åŠ è½½å¤±è´¥: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        function sortAndDisplayProcesses() {
            const sortedProcesses = [...allProcesses];
            
            switch (currentSort) {
                case 'name':
                    sortedProcesses.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'cpu':
                    sortedProcesses.sort((a, b) => b.cpuUsage - a.cpuUsage);
                    break;
                case 'memory':
                    sortedProcesses.sort((a, b) => b.memoryUsage - a.memoryUsage);
                    break;
                case 'pid':
                    sortedProcesses.sort((a, b) => a.pid - b.pid);
                    break;
            }
            
            const displayProcesses = showAllProcesses ? sortedProcesses : sortedProcesses.slice(0, 20);
            displayProcessList(displayProcesses);
        }

        function displayProcessList(processes) {
            const tbody = document.getElementById('processTableBody');
            
            if (processes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">
                            æ²¡æœ‰æ‰¾åˆ°è¿›ç¨‹ä¿¡æ¯
                        </td>
                    </tr>
                `;
                return;
            }
            
            const validProcesses = processes.map(process => {
                let cpuUsage = process.cpuUsage;
                if (!isFinite(cpuUsage) || cpuUsage < 0 || cpuUsage > 100) {
                    cpuUsage = 0;
                }
                
                return {
                    ...process,
                    cpuUsage: cpuUsage
                };
            });
            
            tbody.innerHTML = validProcesses.map(process => `
                <tr>
                    <td class="process-pid">${process.pid}</td>
                    <td class="process-name" title="${process.name}">${process.name}</td>
                    <td class="process-cpu">${process.cpuUsage.toFixed(1)}%</td>
                    <td class="process-memory">${formatBytes(process.memoryUsage)}</td>
                    <td>${process.threadCount}</td>
                    <td class="process-user" title="${process.username}">${process.username}</td>
                    <td>
                        <span class="process-state state-running">${process.state}</span>
                    </td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" 
                        title="${process.fullPath || ''}">
                        ${process.fullPath || 'N/A'}
                    </td>
                </tr>
            `).join('');
        }

        function sortProcesses() {
            currentSort = document.getElementById('sortSelect').value;
            sortAndDisplayProcesses();
        }

        function toggleProcessList() {
            const processList = document.getElementById('processList');
            const card = processList.closest('.card');
            card.classList.toggle('collapsed');
        }

        function toggleAllProcesses() {
            showAllProcesses = !showAllProcesses;
            const button = document.querySelector('.show-all-btn');
            button.textContent = showAllProcesses ? 'æ˜¾ç¤ºå‰20ä¸ªè¿›ç¨‹' : 'æ˜¾ç¤ºå…¨éƒ¨è¿›ç¨‹';
            sortAndDisplayProcesses();
        }
        
        // æ³¨å†Œè¡¨ç›¸å…³åŠŸèƒ½
        let currentRegistrySnapshot = null;
        let savedSnapshots = [];

        // åŠ è½½æ³¨å†Œè¡¨å¿«ç…§
        async function loadRegistrySnapshot() {
            try {
                console.log('å¼€å§‹åŠ è½½æ³¨å†Œè¡¨å¿«ç…§...');
                const response = await fetch('/api/registry/snapshot');
                
                console.log('å“åº”çŠ¶æ€:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText}`);
                }
                
                const responseText = await response.text();
                console.log('å“åº”å†…å®¹:', responseText);
                
                if (!responseText) {
                    throw new Error('æœåŠ¡å™¨è¿”å›ç©ºå“åº”');
                }
                
                const data = JSON.parse(responseText);
                console.log('è§£æåçš„æ•°æ®:', data);
                
                currentRegistrySnapshot = data;
                displayRegistrySnapshot(data);
                
                document.getElementById('registrySnapshotCount').textContent = 
                    `(ç³»ç»Ÿ: ${data.systemInfo.length}, è½¯ä»¶: ${data.software.length}, ç½‘ç»œ: ${data.network.length})`;
                    
            } catch (error) {
                console.error('åŠ è½½æ³¨å†Œè¡¨å¿«ç…§å¤±è´¥:', error);
                alert('åŠ è½½æ³¨å†Œè¡¨å¿«ç…§å¤±è´¥: ' + error.message);
            }
        }

        // ä¿å­˜æ³¨å†Œè¡¨å¿«ç…§
        async function saveRegistrySnapshot() {
            try {
                const snapshotName = document.getElementById('snapshotName').value || 
                                `snapshot_${new Date().toISOString().replace(/[:.]/g, '-')}`;
                
                console.log('å¼€å§‹ä¿å­˜å¿«ç…§:', snapshotName);
                
                // é¦–å…ˆè·å–å½“å‰çš„æ³¨å†Œè¡¨å¿«ç…§
                console.log('æ­£åœ¨è·å–å½“å‰æ³¨å†Œè¡¨çŠ¶æ€...');
                const snapshotResponse = await fetch('/api/registry/snapshot');
                
                if (!snapshotResponse.ok) {
                    throw new Error(`è·å–å¿«ç…§å¤±è´¥: ${snapshotResponse.status}`);
                }
                
                const snapshotData = await snapshotResponse.json();
                console.log('è·å–åˆ°å¿«ç…§æ•°æ®:', snapshotData);
                
                // å‘é€åŒ…å«å¿«ç…§æ•°æ®çš„POSTè¯·æ±‚
                const saveData = {
                    snapshotName: snapshotName,
                    timestamp: Date.now(),
                    systemInfo: snapshotData.systemInfo || [],
                    software: snapshotData.software || [],
                    network: snapshotData.network || []
                };
                
                console.log('å‘é€ä¿å­˜è¯·æ±‚ï¼Œæ•°æ®å¤§å°:', JSON.stringify(saveData).length, 'å­—èŠ‚');
                
                const response = await fetch('/api/registry/snapshot/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(saveData)
                });
                
                console.log('ä¿å­˜å“åº”çŠ¶æ€:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText} - ${errorText}`);
                }
                
                const result = await response.json();
                console.log('ä¿å­˜ç»“æœ:', result);
                
                if (result.success) {
                    alert('å¿«ç…§ä¿å­˜æˆåŠŸ: ' + snapshotName);
                    document.getElementById('snapshotName').value = '';
                    loadSavedSnapshots();
                } else {
                    alert('ä¿å­˜å¤±è´¥: ' + result.error);
                }
            } catch (error) {
                console.error('ä¿å­˜å¿«ç…§å¤±è´¥:', error);
                alert('ä¿å­˜å¿«ç…§å¤±è´¥: ' + error.message);
            }
        }

        // åŠ è½½å·²ä¿å­˜çš„å¿«ç…§åˆ—è¡¨
        async function loadSavedSnapshots() {
            try {
                const response = await fetch('/api/registry/snapshots');
                savedSnapshots = await response.json();
                
                displaySavedSnapshots();
                updateComparisonSelects();
                
            } catch (error) {
                console.error('åŠ è½½å¿«ç…§åˆ—è¡¨å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºå·²ä¿å­˜çš„å¿«ç…§
        function displaySavedSnapshots() {
            const container = document.getElementById('savedSnapshotsList');
            
            if (savedSnapshots.length === 0) {
                container.innerHTML = '<p>æš‚æ— ä¿å­˜çš„å¿«ç…§</p>';
                return;
            }
            
            container.innerHTML = savedSnapshots.map(snapshot => `
                <div class="snapshot-item">
                    <div class="snapshot-name">${snapshot.name}</div>
                    <div class="snapshot-meta">
                        æ—¶é—´: ${new Date(snapshot.timestamp).toLocaleString()}<br>
                        ç³»ç»Ÿ: ${snapshot.systemInfoCount} | è½¯ä»¶: ${snapshot.softwareCount} | ç½‘ç»œ: ${snapshot.networkCount}
                    </div>
                    <div class="snapshot-actions">
                        <button class="btn-danger" onclick="deleteSnapshot('${snapshot.name}')">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        // åˆ é™¤å¿«ç…§
        async function deleteSnapshot(snapshotName) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤å¿«ç…§ "${snapshotName}" å—ï¼Ÿ`)) {
                return;
            }
            try {
                
                const response = await fetch(`/api/registry/snapshots/delete/${encodeURIComponent(snapshotName)}`, {
                // const response = await fetch(`/api/registry/snapshots/${encodeURIComponent(snapshotName)}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    loadSavedSnapshots();
                } else {
                    alert('åˆ é™¤å¤±è´¥: ' + result.error);
                }
            } catch (error) {
                console.error('åˆ é™¤å¿«ç…§å¤±è´¥:', error);
                alert('åˆ é™¤å¿«ç…§å¤±è´¥: ' + error.message);
            }
        }

        // æ›´æ–°æ¯”è¾ƒé€‰æ‹©æ¡†
        function updateComparisonSelects() {
            const select1 = document.getElementById('compareSnapshot1');
            const select2 = document.getElementById('compareSnapshot2');
            
            select1.innerHTML = '<option value="">é€‰æ‹©ç¬¬ä¸€ä¸ªå¿«ç…§</option>';
            select2.innerHTML = '<option value="">é€‰æ‹©ç¬¬äºŒä¸ªå¿«ç…§</option>';
            
            savedSnapshots.forEach(snapshot => {
                const option = `<option value="${snapshot.name}">${snapshot.name}</option>`;
                select1.innerHTML += option;
                select2.innerHTML += option;
            });
        }

        // æ¯”è¾ƒå¿«ç…§
        async function compareSnapshots() {
            try {
                const snapshot1 = document.getElementById('compareSnapshot1').value;
                const snapshot2 = document.getElementById('compareSnapshot2').value;
                
                if (!snapshot1 || !snapshot2) {
                    alert('è¯·é€‰æ‹©è¦æ¯”è¾ƒçš„ä¸¤ä¸ªå¿«ç…§');
                    return;
                }
                
                if (snapshot1 === snapshot2) {
                    alert('è¯·é€‰æ‹©ä¸¤ä¸ªä¸åŒçš„å¿«ç…§è¿›è¡Œæ¯”è¾ƒ');
                    return;
                }
                
                console.log('å¼€å§‹æ¯”è¾ƒå¿«ç…§:', snapshot1, 'vs', snapshot2);
                
                // ä¿®æ”¹ä¸ºPOSTè¯·æ±‚ï¼Œé€šè¿‡è¯·æ±‚ä½“ä¼ é€’å‚æ•°
                const requestBody = {
                    snapshot1: snapshot1,
                    snapshot2: snapshot2
                };
                
                const response = await fetch('/api/registry/snapshots/compare', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                console.log('æ¯”è¾ƒå“åº”çŠ¶æ€:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('æ¯”è¾ƒå“åº”å†…å®¹:', errorText);
                    throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText} - ${errorText}`);
                }
                
                // æ£€æŸ¥å“åº”å†…å®¹ç±»å‹
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    console.error('éJSONå“åº”:', text);
                    throw new Error('æœåŠ¡å™¨è¿”å›äº†éJSONæ ¼å¼çš„å“åº”');
                }
                
                const result = await response.json();
                console.log('æ¯”è¾ƒç»“æœ:', result);
                
                displayComparisonResult(result);
                
            } catch (error) {
                console.error('æ¯”è¾ƒå¿«ç…§å¤±è´¥:', error);
                alert('æ¯”è¾ƒå¿«ç…§å¤±è´¥: ' + error.message);
            }
        }

        // æ˜¾ç¤ºæ¯”è¾ƒç»“æœ
        function displayComparisonResult(result) {
            const container = document.getElementById('comparisonResult');
            
            let html = `
                <h5>å¿«ç…§æ¯”è¾ƒç»“æœ: ${result.snapshot1} vs ${result.snapshot2}</h5>
                <p>æ—¶é—´: ${new Date(result.timestamp1).toLocaleString()} vs ${new Date(result.timestamp2).toLocaleString()}</p>
            `;
            
            // ç³»ç»Ÿä¿¡æ¯å˜åŒ–
            html += `<h6>ç³»ç»Ÿä¿¡æ¯å˜åŒ–:</h6>`;
            html += displayChanges(result.systemInfoChanges);
            
            // è½¯ä»¶ä¿¡æ¯å˜åŒ–
            html += `<h6>è½¯ä»¶ä¿¡æ¯å˜åŒ–:</h6>`;
            html += displayChanges(result.softwareChanges);
            
            // ç½‘ç»œé…ç½®å˜åŒ–
            html += `<h6>ç½‘ç»œé…ç½®å˜åŒ–:</h6>`;
            html += displayChanges(result.networkChanges);
            
            container.innerHTML = html;
        }

        function displayChanges(changes) {
            return `
                <div class="change-added">æ–°å¢: ${changes.added.length} é¡¹</div>
                <div class="change-removed">åˆ é™¤: ${changes.removed.length} é¡¹</div>
                <div class="change-modified">ä¿®æ”¹: ${changes.modified.length} é¡¹</div>
            `;
        }

        // æ˜¾ç¤ºæ³¨å†Œè¡¨å¿«ç…§
        function displayRegistrySnapshot(snapshot) {
            displaySystemInfo(snapshot.systemInfo);
            displaySoftwareInfo(snapshot.software);
            displayNetworkInfo(snapshot.network);
        }

        function displaySystemInfo(systemInfo) {
            const container = document.getElementById('systemInfoContent');
            container.innerHTML = systemInfo.map(key => `
                <div class="registry-key">
                    <div class="registry-key-header">${key.path}</div>
                    <div class="registry-key-content">
                        ${key.values.map(value => `
                            <div class="registry-value">
                                <div class="registry-value-name">${value.name}</div>
                                <div class="registry-value-type">${value.type}</div>
                                <div class="registry-value-data">${value.data}</div>
                            </div>
                        `).join('')}
                        ${key.subkeys.length > 0 ? `<div><strong>å­é”®:</strong> ${key.subkeys.join(', ')}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function displaySoftwareInfo(softwareInfo) {
            const container = document.getElementById('softwareContent');
            container.innerHTML = softwareInfo.map(key => `
                <div class="registry-key">
                    <div class="registry-key-header">${key.path}</div>
                    <div class="registry-key-content">
                        ${key.values.map(value => `
                            <div class="registry-value">
                                <div class="registry-value-name">${value.name}</div>
                                <div class="registry-value-type">${value.type}</div>
                                <div class="registry-value-data">${value.data}</div>
                            </div>
                        `).join('')}
                        ${key.subkeys.length > 0 ? `<div><strong>å­é”®:</strong> ${key.subkeys.join(', ')}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function displayNetworkInfo(networkInfo) {
            const container = document.getElementById('networkContent');
            container.innerHTML = networkInfo.map(key => `
                <div class="registry-key">
                    <div class="registry-key-header">${key.path}</div>
                    <div class="registry-key-content">
                        ${key.values.map(value => `
                            <div class="registry-value">
                                <div class="registry-value-name">${value.name}</div>
                                <div class="registry-value-type">${value.type}</div>
                                <div class="registry-value-data">${value.data}</div>
                            </div>
                        `).join('')}
                        ${key.subkeys.length > 0 ? `<div><strong>å­é”®:</strong> ${key.subkeys.join(', ')}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // åˆ‡æ¢æ³¨å†Œè¡¨æ ‡ç­¾é¡µ
        function switchRegistryTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        // åˆ‡æ¢æ³¨å†Œè¡¨åŒºåŸŸæ˜¾ç¤º/éšè—
        function toggleRegistrySection() {
            const registrySection = document.getElementById('registrySection');
            const card = registrySection.closest('.card');
            card.classList.toggle('collapsed');
        }


        // é©±åŠ¨ä¿¡æ¯ç›¸å…³å˜é‡
        let currentDriversData = null;
        let driverShowAll = false;

        // åˆ‡æ¢é©±åŠ¨åˆ—è¡¨æ˜¾ç¤º/éšè—
        function toggleDriverList() {
            const driverList = document.getElementById('driverList');
            const header = document.querySelector('.process-header');
            driverList.classList.toggle('collapsed');
            header.classList.toggle('collapsed');
        }

        // åˆ‡æ¢é©±åŠ¨æ ‡ç­¾é¡µ
        function switchDriverTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('#driverList .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
            document.querySelectorAll('#driverList .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­¾é¡µå’Œæ ‡ç­¾
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        // åŠ è½½é©±åŠ¨ä¿¡æ¯
        async function loadDriverInfo() {
            try {
                const response = await fetch('/api/drivers/snapshot');
                if (!response.ok) {
                    throw new Error('è·å–é©±åŠ¨ä¿¡æ¯å¤±è´¥');
                }
                
                const data = await response.json();
                currentDriversData = data;
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateDriverStats(data);
                
                // æ›´æ–°å„æ ‡ç­¾é¡µå†…å®¹
                updateDriverTables(data);
                
                // æ›´æ–°è®¡æ•°æ˜¾ç¤º
                document.getElementById('driverCount').textContent = 
                    `æ€»è®¡: ${data.statistics.totalDrivers} ä¸ªé©±åŠ¨`;
                    
                console.log('é©±åŠ¨ä¿¡æ¯åŠ è½½æˆåŠŸ');
                
            } catch (error) {
                console.error('åŠ è½½é©±åŠ¨ä¿¡æ¯å¤±è´¥:', error);
                alert('åŠ è½½é©±åŠ¨ä¿¡æ¯å¤±è´¥: ' + error.message);
            }
        }

        // æ›´æ–°é©±åŠ¨ç»Ÿè®¡ä¿¡æ¯
        function updateDriverStats(data) {
            const stats = data.statistics;
            const statsGrid = document.getElementById('driverStats');
            
            statsGrid.innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${stats.totalDrivers}</div>
                    <div class="stat-label">æ€»é©±åŠ¨æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.runningCount}</div>
                    <div class="stat-label">è¿è¡Œä¸­</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.stoppedCount}</div>
                    <div class="stat-label">å·²åœæ­¢</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.kernelCount}</div>
                    <div class="stat-label">å†…æ ¸é©±åŠ¨</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.fileSystemCount}</div>
                    <div class="stat-label">æ–‡ä»¶ç³»ç»Ÿ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.autoStartCount}</div>
                    <div class="stat-label">è‡ªåŠ¨å¯åŠ¨</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.thirdPartyCount}</div>
                    <div class="stat-label">ç¬¬ä¸‰æ–¹</div>
                </div>
            `;
        }

        // æ›´æ–°é©±åŠ¨è¡¨æ ¼
        function updateDriverTables(data) {
            updateAllDriversTable(data);
            updateRunningDriversTable(data);
            updateKernelDriversTable(data);
            updateFilesystemDriversTable(data);
            updateAutostartDriversTable(data);
            updateThirdpartyDriversTable(data);
        }

        // æ›´æ–°å…¨éƒ¨é©±åŠ¨è¡¨æ ¼
        function updateAllDriversTable(data) {
            const tbody = document.getElementById('allDriversTableBody');
            const allDrivers = [
                ...data.kernelDrivers,
                ...data.fileSystemDrivers
            ];
            
            tbody.innerHTML = allDrivers.map(driver => `
                <tr>
                    <td class="process-name" title="${driver.name}">${driver.name}</td>
                    <td title="${driver.displayName}">${truncateText(driver.displayName, 25)}</td>
                    <td><span class="process-state ${getDriverStateClass(driver.state)}">${driver.state}</span></td>
                    <td>${driver.driverType || driver.serviceType}</td>
                    <td>${driver.startType}</td>
                    <td title="${driver.binaryPath}">${truncateText(driver.binaryPath, 30)}</td>
                    <td class="process-pid">${driver.pid || '-'}</td>
                    <td>${driver.errorControl || '-'}</td>
                </tr>
            `).join('');
        }

        // æ›´æ–°è¿è¡Œä¸­é©±åŠ¨è¡¨æ ¼
        function updateRunningDriversTable(data) {
            const tbody = document.getElementById('runningDriversTableBody');
            
            tbody.innerHTML = data.runningDrivers.map(driver => `
                <tr>
                    <td class="process-name" title="${driver.name}">${driver.name}</td>
                    <td title="${driver.displayName}">${truncateText(driver.displayName, 25)}</td>
                    <td class="process-pid">${driver.pid}</td>
                    <td title="${driver.binaryPath}">${truncateText(driver.binaryPath, 30)}</td>
                    <td>${driver.startType}</td>
                    <td>${driver.driverType || driver.serviceType}</td>
                    <td title="${driver.description || ''}">${truncateText(driver.description || '', 30)}</td>
                </tr>
            `).join('');
        }

        // æ›´æ–°å†…æ ¸é©±åŠ¨è¡¨æ ¼
        function updateKernelDriversTable(data) {
            const tbody = document.getElementById('kernelDriversTableBody');
            
            tbody.innerHTML = data.kernelDrivers.map(driver => `
                <tr>
                    <td class="process-name" title="${driver.name}">${driver.name}</td>
                    <td title="${driver.displayName}">${truncateText(driver.displayName, 25)}</td>
                    <td><span class="process-state ${getDriverStateClass(driver.state)}">${driver.state}</span></td>
                    <td>${driver.startType}</td>
                    <td title="${driver.binaryPath}">${truncateText(driver.binaryPath, 30)}</td>
                    <td>${driver.errorControl || '-'}</td>
                    <td title="${driver.description || ''}">${truncateText(driver.description || '', 30)}</td>
                </tr>
            `).join('');
        }

        // æ›´æ–°æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨è¡¨æ ¼
        function updateFilesystemDriversTable(data) {
            const tbody = document.getElementById('filesystemDriversTableBody');
            
            tbody.innerHTML = data.fileSystemDrivers.map(driver => `
                <tr>
                    <td class="process-name" title="${driver.name}">${driver.name}</td>
                    <td title="${driver.displayName}">${truncateText(driver.displayName, 25)}</td>
                    <td><span class="process-state ${getDriverStateClass(driver.state)}">${driver.state}</span></td>
                    <td>${driver.startType}</td>
                    <td title="${driver.binaryPath}">${truncateText(driver.binaryPath, 30)}</td>
                    <td>${driver.errorControl || '-'}</td>
                    <td title="${driver.description || ''}">${truncateText(driver.description || '', 30)}</td>
                </tr>
            `).join('');
        }

        // æ›´æ–°è‡ªåŠ¨å¯åŠ¨é©±åŠ¨è¡¨æ ¼
        function updateAutostartDriversTable(data) {
            const tbody = document.getElementById('autostartDriversTableBody');
            
            tbody.innerHTML = data.autoStartDrivers.map(driver => `
                <tr>
                    <td class="process-name" title="${driver.name}">${driver.name}</td>
                    <td title="${driver.displayName}">${truncateText(driver.displayName, 25)}</td>
                    <td><span class="process-state ${getDriverStateClass(driver.state)}">${driver.state}</span></td>
                    <td>${driver.startType}</td>
                    <td title="${driver.binaryPath}">${truncateText(driver.binaryPath, 30)}</td>
                    <td>${driver.driverType || driver.serviceType}</td>
                    <td title="${driver.description || ''}">${truncateText(driver.description || '', 30)}</td>
                </tr>
            `).join('');
        }

        // æ›´æ–°ç¬¬ä¸‰æ–¹é©±åŠ¨è¡¨æ ¼
        function updateThirdpartyDriversTable(data) {
            const tbody = document.getElementById('thirdpartyDriversTableBody');
            
            tbody.innerHTML = data.thirdPartyDrivers.map(driver => `
                <tr>
                    <td class="process-name" title="${driver.name}">${driver.name}</td>
                    <td title="${driver.displayName}">${truncateText(driver.displayName, 25)}</td>
                    <td><span class="process-state ${getDriverStateClass(driver.state)}">${driver.state}</span></td>
                    <td>${driver.startType}</td>
                    <td title="${driver.binaryPath}">${truncateText(driver.binaryPath, 40)}</td>
                    <td>${driver.driverType || driver.serviceType}</td>
                    <td class="process-pid">${driver.pid || '-'}</td>
                </tr>
            `).join('');
        }

        // è·å–é©±åŠ¨çŠ¶æ€å¯¹åº”çš„CSSç±»
        function getDriverStateClass(state) {
            switch (state.toLowerCase()) {
                case 'running':
                    return 'state-running';
                case 'stopped':
                    return 'state-stopped';
                case 'start pending':
                    return 'state-pending';
                case 'stop pending':
                    return 'state-pending';
                default:
                    return 'state-unknown';
            }
        }

        // æ’åºé©±åŠ¨
        function sortDrivers() {
            if (!currentDriversData) return;
            
            const sortBy = document.getElementById('driverSortSelect').value;
            
            // å¯¹æ¯ä¸ªåˆ†ç±»çš„é©±åŠ¨è¿›è¡Œæ’åº
            const sortFunctions = {
                name: (a, b) => a.name.localeCompare(b.name),
                state: (a, b) => a.state.localeCompare(b.state),
                type: (a, b) => (a.driverType || a.serviceType).localeCompare(b.driverType || b.serviceType),
                startType: (a, b) => a.startType.localeCompare(b.startType)
            };
            
            const sortFunction = sortFunctions[sortBy] || sortFunctions.name;
            
            // æ›´æ–°æ‰€æœ‰è¡¨æ ¼
            updateDriverTables({
                ...currentDriversData,
                kernelDrivers: [...currentDriversData.kernelDrivers].sort(sortFunction),
                fileSystemDrivers: [...currentDriversData.fileSystemDrivers].sort(sortFunction),
                runningDrivers: [...currentDriversData.runningDrivers].sort(sortFunction),
                stoppedDrivers: [...currentDriversData.stoppedDrivers].sort(sortFunction),
                autoStartDrivers: [...currentDriversData.autoStartDrivers].sort(sortFunction),
                thirdPartyDrivers: [...currentDriversData.thirdPartyDrivers].sort(sortFunction)
            });
        }

        // åˆ‡æ¢æ˜¾ç¤ºæ‰€æœ‰é©±åŠ¨è¯¦ç»†ä¿¡æ¯
        function toggleAllDrivers() {
            driverShowAll = !driverShowAll;
            const btn = event.target;
            
            if (driverShowAll) {
                btn.textContent = 'æ˜¾ç¤ºç®€æ´ä¿¡æ¯';
                // å¯ä»¥åœ¨è¿™é‡Œå±•å¼€æ›´å¤šè¯¦ç»†ä¿¡æ¯
                document.querySelectorAll('#driverList .process-table td').forEach(td => {
                    td.style.whiteSpace = 'normal';
                });
            } else {
                btn.textContent = 'æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯';
                document.querySelectorAll('#driverList .process-table td').forEach(td => {
                    td.style.whiteSpace = 'nowrap';
                });
            }
        }

        // å·¥å…·å‡½æ•°ï¼šæˆªæ–­æ–‡æœ¬
        function truncateText(text, maxLength) {
            if (!text) return '-';
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }

        // åœ¨é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½é©±åŠ¨ä¿¡æ¯
        document.addEventListener('DOMContentLoaded', function() {
            // å»¶è¿ŸåŠ è½½é©±åŠ¨ä¿¡æ¯ï¼Œé¿å…åŒæ—¶è¯·æ±‚è¿‡å¤šæ•°æ®
            setTimeout(loadDriverInfo, 2000);
        });
        // åˆå§‹åŒ–æ—¶åŠ è½½æ³¨å†Œè¡¨æ•°æ®
        loadRegistrySnapshot();
        loadSavedSnapshots();

        // åˆå§‹åŒ–
        fetchCPUInfo();
        updateCPUUsage();
        loadProcesses();
        loadDiskInfo();
        
        // å®šæ—¶æ›´æ–°
        setInterval(updateCPUUsage, 1000);
        setInterval(fetchCPUInfo, 30000);
        setInterval(loadProcesses, 5000);
        setInterval(loadDiskInfo, 10000); // 10ç§’æ›´æ–°ä¸€æ¬¡ç£ç›˜ä¿¡æ¯
    </script>
</body>
</html>