<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á≥ªÁªüÁõëÊéßÈù¢Êùø</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .usage-meter {
            width: 100%;
            height: 30px;
            background-color: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        .usage-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #FFC107, #F44336);
            transition: width 0.5s ease;
        }
        .disk-usage-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }
        .disk-usage-fill {
            height: 100%;
            background: linear-gradient(90deg, #2196F3, #03A9F4);
            transition: width 0.5s ease;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2196F3;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        /* ËøõÁ®ãÂàóË°®Ê†∑Âºè */
        .process-header, .disk-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .process-header:hover, .disk-header:hover {
            background: #e9ecef;
        }
        .process-controls, .disk-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .sort-select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        .refresh-btn {
            padding: 5px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .refresh-btn:hover {
            background: #0056b3;
        }
        .process-list, .disk-list {
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .process-table, .disk-table {
            width: 100%;
            border-collapse: collapse;
        }
        .process-table th, .disk-table th {
            background: #f8f9fa;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
        }
        .process-table td, .disk-table td {
            padding: 8px;
            border-bottom: 1px solid #e0e0e0;
        }
        .process-table tr:hover, .disk-table tr:hover {
            background: #f8f9fa;
        }
        .process-name {
            font-weight: 500;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .process-pid {
            color: #666;
            font-family: monospace;
        }
        .process-cpu {
            color: #e74c3c;
            font-weight: 500;
        }
        .process-memory {
            color: #3498db;
            font-weight: 500;
        }
        .process-user {
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .process-state {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .state-running {
            background: #d4edda;
            color: #155724;
        }
        .collapsed .process-list, .collapsed .disk-list {
            display: none;
        }
        .toggle-icon {
            transition: transform 0.3s ease;
        }
        .collapsed .toggle-icon {
            transform: rotate(-90deg);
        }
        .show-all-btn {
            width: 100%;
            padding: 10px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        .show-all-btn:hover {
            background: #545b62;
        }
        
        /* Á£ÅÁõò‰ø°ÊÅØÊ†∑Âºè */
        .disk-drive-letter {
            font-weight: bold;
            color: #2196F3;
            font-size: 16px;
        }
        .disk-usage-percent {
            font-weight: bold;
            color: #e74c3c;
        }
        .disk-size {
            color: #666;
            font-family: monospace;
        }
        .disk-file-system {
            color: #27ae60;
            font-weight: 500;
        }
        .disk-status {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-healthy {
            background: #d4edda;
            color: #155724;
        }
        .status-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        /* ÊÄßËÉΩÊåáÊ†áÊ†∑Âºè */
        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .performance-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        .performance-value {
            font-size: 20px;
            font-weight: bold;
            color: #2196F3;
        }
        .performance-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        /* ÈÄâÈ°πÂç°Ê†∑Âº? */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background: white;
            border-color: #ddd;
            border-bottom-color: white;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üñ•Ô∏? Á≥ªÁªüÁõëÊéßÈù¢Êùø</h1>
        
        <div class="card">
            <h2>CPU‰ΩøÁî®Áé?</h2>
            <div class="usage-meter">
                <div id="usageBar" class="usage-bar" style="width: 0%"></div>
            </div>
            <div id="usageText" style="text-align: center; font-size: 24px; font-weight: bold;">0%</div>
        </div>

        <div class="card">
            <h2>CPU‰ø°ÊÅØ</h2>
            <div id="cpuInfo">
                <p>Âä†ËΩΩ‰∏?...</p>
            </div>
        </div>

        <div class="card">
            <h2>ÂÆûÊó∂Êï∞ÊçÆ</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="currentUsage">0%</div>
                    <div class="stat-label">ÂΩìÂâç‰ΩøÁî®Áé?</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="coreCount">0</div>
                    <div class="stat-label">Áâ©ÁêÜÊ†∏ÂøÉ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="threadCount">0</div>
                    <div class="stat-label">ÈÄªËæëÊ†∏ÂøÉ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="frequency">0</div>
                    <div class="stat-label">Âü∫Á?ÄÈ¢ëÁéá (MHz)</div>
                </div>
            </div>
        </div>

        <!-- Á£ÅÁõò‰ø°ÊÅØÁ™óÂè£ -->
        <div class="card">
            <div class="disk-header" onclick="toggleDiskList()">
                <h2 style="margin: 0;">Á£ÅÁõò‰ø°ÊÅØ 
                    <span id="diskCount" style="font-size: 14px; color: #666; margin-left: 10px;"></span>
                </h2>
                <div class="disk-controls" onclick="event.stopPropagation()">
                    <button class="refresh-btn" onclick="loadDiskInfo()">Âà∑Êñ∞</button>
                    <span class="toggle-icon">‚ñ?</span>
                </div>
            </div>
            
            <div id="diskList" class="disk-list">
                <!-- ÈÄâÈ°πÂç? -->
                <div class="tabs">
                    <div class="tab active" onclick="switchDiskTab('partitions')">ÂàÜÂå∫‰ø°ÊÅØ</div>
                    <div class="tab" onclick="switchDiskTab('performance')">ÊÄßËÉΩÁõëÊéß</div>
                    <div class="tab" onclick="switchDiskTab('drives')">Á£ÅÁõòÈ©±Âä®Âô?</div>
                </div>
                
                <!-- ÂàÜÂå∫‰ø°ÊÅØÊ†áÁ?æÈ°µ -->
                <div id="partitionsTab" class="tab-content active">
                    <table class="disk-table">
                        <thead>
                            <tr>
                                <th width="8%">ÁõòÁ??</th>
                                <th width="15%">Âç∑Ê†á</th>
                                <th width="12%">Êñá‰ª∂Á≥ªÁªü</th>
                                <th width="15%">ÊÄªÁ©∫Èó?</th>
                                <th width="15%">Â∑≤Áî®Á©∫Èó¥</th>
                                <th width="15%">Âè?Áî®Á©∫Èó?</th>
                                <th width="10%">‰ΩøÁî®Áé?</th>
                                <th width="10%">Áä∂ÊÄ?</th>
                            </tr>
                        </thead>
                        <tbody id="partitionsTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 20px;">
                                    Âä†ËΩΩ‰∏?...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- ÊÄßËÉΩÁõëÊéßÊ†áÁ?æÈ°µ -->
                <div id="performanceTab" class="tab-content">
                    <div id="performanceContent">
                        <p style="text-align: center; padding: 20px;">Âä†ËΩΩ‰∏?...</p>
                    </div>
                </div>
                
                <!-- Á£ÅÁõòÈ©±Âä®Âô®Ê†áÁ≠æÈ°µ -->
                <div id="drivesTab" class="tab-content">
                    <table class="disk-table">
                        <thead>
                            <tr>
                                <th width="20%">ÂûãÂè∑</th>
                                <th width="15%">Â∫èÂàóÂè?</th>
                                <th width="10%">Êé•Âè£Á±ªÂûã</th>
                                <th width="10%">‰ªãË¥®Á±ªÂûã</th>
                                <th width="15%">ÊÄªÂ?πÈáè</th>
                                <th width="10%">ÊâáÂå∫Â§ßÂ∞è</th>
                                <th width="10%">Áä∂ÊÄ?</th>
                                <th width="10%">ËÆæÂ?áID</th>
                            </tr>
                        </thead>
                        <tbody id="drivesTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 20px;">
                                    Âä†ËΩΩ‰∏?...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ËøõÁ®ã‰ø°ÊÅØÁ™óÂè£ -->
        <div class="card">
            <div class="process-header" onclick="toggleProcessList()">
                <h2 style="margin: 0;">ËøõÁ®ã‰ø°ÊÅØ 
                    <span id="processCount" style="font-size: 14px; color: #666; margin-left: 10px;"></span>
                </h2>
                <div class="process-controls" onclick="event.stopPropagation()">
                    <span>ÊéíÂ∫èÊñπÂºè:</span>
                    <select class="sort-select" id="sortSelect" onchange="sortProcesses()">
                        <option value="name">ËøõÁ®ãÂêçÁß∞</option>
                        <option value="cpu">CPUÂç†Áî®Áé?</option>
                        <option value="memory">ÂÜÖÂ≠òÂç†Áî®</option>
                        <option value="pid">ËøõÁ®ãID</option>
                    </select>
                    <button class="refresh-btn" onclick="loadProcesses()">Âà∑Êñ∞</button>
                    <span class="toggle-icon">‚ñ?</span>
                </div>
            </div>
            
            <div id="processList" class="process-list">
                <table class="process-table">
                    <thead>
                        <tr>
                            <th width="5%">PID</th>
                            <th width="20%">ËøõÁ®ãÂêçÁß∞</th>
                            <th width="10%">CPU</th>
                            <th width="15%">ÂÜÖÂ≠ò</th>
                            <th width="10%">Á∫øÁ®ã</th>
                            <th width="15%">Áî®Êà∑Âê?</th>
                            <th width="10%">Áä∂ÊÄ?</th>
                            <th width="15%">Ë∑?Âæ?</th>
                        </tr>
                    </thead>
                    <tbody id="processTableBody">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 20px;">
                                Âä†ËΩΩ‰∏?...
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button class="show-all-btn" onclick="toggleAllProcesses()">ÊòæÁ§∫ÂÖ®ÈÉ®ËøõÁ®ã</button>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let allProcesses = [];
        let showAllProcesses = false;
        let currentSort = 'name';
        let diskData = {};

        // Ëé∑ÂèñCPU‰ø°ÊÅØ
        async function fetchCPUInfo() {
            try {
                const response = await fetch('/api/cpu/info');
                const data = await response.json();
                
                document.getElementById('cpuInfo').innerHTML = `
                    <p><strong>ÂêçÁß∞:</strong> ${data.name}</p>
                    <p><strong>Êû∂ÊûÑ:</strong> ${data.architecture}</p>
                    <p><strong>Áâ©ÁêÜÊ†∏ÂøÉ:</strong> ${data.physicalCores}</p>
                    <p><strong>ÈÄªËæëÊ†∏ÂøÉ:</strong> ${data.logicalCores}</p>
                    <p><strong>Âü∫Á?ÄÈ¢ëÁéá:</strong> ${data.baseFrequency} MHz</p>
                    ${data.maxFrequency ? `<p><strong>ÊúÄÂ§ßÈ?ëÁéá:</strong> ${data.maxFrequency} MHz</p>` : ''}
                `;
                
                document.getElementById('coreCount').textContent = data.physicalCores;
                document.getElementById('threadCount').textContent = data.logicalCores;
                document.getElementById('frequency').textContent = data.baseFrequency;
            } catch (error) {
                console.error('Ëé∑ÂèñCPU‰ø°ÊÅØÂ§±Ë¥•:', error);
            }
        }

        // Êõ¥Êñ∞CPU‰ΩøÁî®Áé?
        function updateCPUUsage() {
            fetch('/api/cpu/usage')
                .then(response => response.json())
                .then(data => {
                    const usage = data.usage.toFixed(1);
                    document.getElementById('usageText').textContent = usage + '%';
                    document.getElementById('usageBar').style.width = usage + '%';
                    document.getElementById('currentUsage').textContent = usage + '%';
                })
                .catch(error => console.error('Ëé∑ÂèñCPU‰ΩøÁî®ÁéáÂ§±Ë¥?:', error));
        }

        // Âä†ËΩΩÁ£ÅÁõò‰ø°ÊÅØ
        async function loadDiskInfo() {
            try {
                const response = await fetch('/api/disk/info');
                const data = await response.json();
                
                diskData = data;
                document.getElementById('diskCount').textContent = `(${data.partitions ? data.partitions.length : 0} ‰∏?ÂàÜÂå∫)`;
                
                displayPartitions(data.partitions || []);
                displayDrives(data.drives || []);
                
            } catch (error) {
                console.error('Ëé∑ÂèñÁ£ÅÁõò‰ø°ÊÅØÂ§±Ë¥•:', error);
                document.getElementById('partitionsTableBody').innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; color: #dc3545; padding: 20px;">
                            Âä†ËΩΩÂ§±Ë¥•: ${error.message}
                        </td>
                    </tr>
                `;
            }
            
            // Âä†ËΩΩÊÄßËÉΩÊï∞ÊçÆ
            loadDiskPerformance();
        }

        // ÊòæÁ§∫ÂàÜÂå∫‰ø°ÊÅØ
        function displayPartitions(partitions) {
            const tbody = document.getElementById('partitionsTableBody');
            
            if (partitions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">
                            Ê≤°ÊúâÊâæÂà∞ÂàÜÂå∫‰ø°ÊÅØ
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = partitions.map(partition => {
                const usagePercentage = partition.usagePercentage || 0;
                const status = usagePercentage > 90 ? 'Warning' : 'Healthy';
                
                return `
                    <tr>
                        <td class="disk-drive-letter">${partition.driveLetter}</td>
                        <td>${partition.label || 'Êó†Âç∑Ê†?'}</td>
                        <td class="disk-file-system">${partition.fileSystem || 'Êú?Áü?'}</td>
                        <td class="disk-size">${formatBytes(partition.totalSize)}</td>
                        <td class="disk-size">${formatBytes(partition.usedSpace)}</td>
                        <td class="disk-size">${formatBytes(partition.freeSpace)}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="disk-usage-percent">${usagePercentage.toFixed(1)}%</span>
                                <div class="disk-usage-bar" style="flex: 1;">
                                    <div class="disk-usage-fill" style="width: ${usagePercentage}%"></div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="disk-status status-${status.toLowerCase()}">${status === 'Healthy' ? 'Ê≠£Â∏∏' : 'Ë≠¶Âëä'}</span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ÊòæÁ§∫Á£ÅÁõòÈ©±Âä®Âô®‰ø°ÊÅ?
        function displayDrives(drives) {
            const tbody = document.getElementById('drivesTableBody');
            
            if (drives.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">
                            Ê≤°ÊúâÊâæÂà∞Á£ÅÁõòÈ©±Âä®Âô®‰ø°ÊÅ?
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = drives.map(drive => `
                <tr>
                    <td title="${drive.model}">${truncateText(drive.model, 25)}</td>
                    <td>${drive.serialNumber || 'Êú?Áü?'}</td>
                    <td>${drive.interfaceType || 'Êú?Áü?'}</td>
                    <td>${drive.mediaType || 'Êú?Áü?'}</td>
                    <td class="disk-size">${formatBytes(drive.totalSize)}</td>
                    <td>${drive.bytesPerSector ? drive.bytesPerSector + ' Â≠óËäÇ' : 'Êú?Áü?'}</td>
                    <td>
                        <span class="disk-status status-healthy">${drive.status || 'Ê≠£Â∏∏'}</span>
                    </td>
                    <td>${drive.deviceId || 'Êú?Áü?'}</td>
                </tr>
            `).join('');
        }

        // Âä†ËΩΩÁ£ÅÁõòÊÄßËÉΩÊï∞ÊçÆ
        async function loadDiskPerformance() {
            try {
                const response = await fetch('/api/disk/performance');
                const data = await response.json();
                
                displayPerformance(data.performance || []);
            } catch (error) {
                console.error('Ëé∑ÂèñÁ£ÅÁõòÊÄßËÉΩÂ§±Ë¥•:', error);
                document.getElementById('performanceContent').innerHTML = `
                    <p style="text-align: center; color: #dc3545;">
                        Âä†ËΩΩÊÄßËÉΩÊï∞ÊçÆÂ§±Ë¥•: ${error.message}
                    </p>
                `;
            }
        }

        // ÊòæÁ§∫ÊÄßËÉΩÊï∞ÊçÆ
        function displayPerformance(performance) {
            const container = document.getElementById('performanceContent');
            
            if (performance.length === 0) {
                container.innerHTML = `
                    <p style="text-align: center; padding: 20px;">
                        Ê≤°ÊúâÊÄßËÉΩÊï∞ÊçÆÂè?Áî?
                    </p>
                `;
                return;
            }
            
            container.innerHTML = performance.map(perf => `
                <div style="margin-bottom: 20px;">
                    <h4>${perf.driveLetter === '_Total' ? 'ÊÄª‰ΩìÁ£ÅÁõòÊÄßËÉΩ' : 'Á£ÅÁõò ' + perf.driveLetter}</h4>
                    <div class="performance-grid">
                        <div class="performance-card">
                            <div class="performance-value">${perf.readSpeed ? perf.readSpeed.toFixed(2) : '0'} MB/s</div>
                            <div class="performance-label">ËØªÂèñÈÄüÂ∫¶</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${perf.writeSpeed ? perf.writeSpeed.toFixed(2) : '0'} MB/s</div>
                            <div class="performance-label">ÂÜôÂÖ•ÈÄüÂ∫¶</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${perf.usagePercentage ? perf.usagePercentage.toFixed(1) : '0'}%</div>
                            <div class="performance-label">Á£ÅÁõò‰ΩøÁî®Áé?</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${perf.queueLength ? perf.queueLength.toFixed(2) : '0'}</div>
                            <div class="performance-label">ÈòüÂàóÈïøÂ∫¶</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${formatBytes(perf.readBytesPerSec || 0)}/s</div>
                            <div class="performance-label">ËØªÂèñÂ≠óËäÇÊï?</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value">${formatBytes(perf.writeBytesPerSec || 0)}/s</div>
                            <div class="performance-label">ÂÜôÂÖ•Â≠óËäÇÊï?</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ÂàáÊç¢Á£ÅÁõòÊ†áÁ?æÈ°µ
        function switchDiskTab(tabName) {
            // ÈöêËóèÊâÄÊúâÊ†áÁ≠æÈ°µÂÜÖÂ??
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ÁßªÈô§ÊâÄÊúâÊ†áÁ≠æÁöÑÊøÄÊ¥ªÁä∂ÊÄ?
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÊ†áÁ≠æÈ°µÂÜÖÂ??
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // ÊøÄÊ¥ªÈÄâ‰∏≠ÁöÑÊ†áÁ≠?
            event.target.classList.add('active');
        }

        // ÂàáÊç¢Á£ÅÁõòÂàóË°®ÊòæÁ§∫/ÈöêËóè
        function toggleDiskList() {
            const diskList = document.getElementById('diskList');
            const card = diskList.closest('.card');
            card.classList.toggle('collapsed');
        }

        // Ê†ºÂºèÂåñÂ≠óËäÇÂ§ßÂ∞?
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Êà?Êñ?ÊñáÊú¨
        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // ËøõÁ®ãÁõ∏ÂÖ≥ÂáΩÊï∞Ôºà‰øùÊåÅ‰∏çÂèòÔºâ
        async function loadProcesses() {
            try {
                const response = await fetch('/api/processes');
                const data = await response.json();
                
                allProcesses = data.processes || [];
                document.getElementById('processCount').textContent = `(${allProcesses.length} ‰∏?ËøõÁ®ã)`;
                
                sortAndDisplayProcesses();
            } catch (error) {
                console.error('Ëé∑ÂèñËøõÁ®ãÂàóË°®Â§±Ë¥•:', error);
                document.getElementById('processTableBody').innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; color: #dc3545; padding: 20px;">
                            Âä†ËΩΩÂ§±Ë¥•: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        function sortAndDisplayProcesses() {
            const sortedProcesses = [...allProcesses];
            
            switch (currentSort) {
                case 'name':
                    sortedProcesses.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'cpu':
                    sortedProcesses.sort((a, b) => b.cpuUsage - a.cpuUsage);
                    break;
                case 'memory':
                    sortedProcesses.sort((a, b) => b.memoryUsage - a.memoryUsage);
                    break;
                case 'pid':
                    sortedProcesses.sort((a, b) => a.pid - b.pid);
                    break;
            }
            
            const displayProcesses = showAllProcesses ? sortedProcesses : sortedProcesses.slice(0, 20);
            displayProcessList(displayProcesses);
        }

        function displayProcessList(processes) {
            const tbody = document.getElementById('processTableBody');
            
            if (processes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">
                            Ê≤°ÊúâÊâæÂà∞ËøõÁ®ã‰ø°ÊÅØ
                        </td>
                    </tr>
                `;
                return;
            }
            
            const validProcesses = processes.map(process => {
                let cpuUsage = process.cpuUsage;
                if (!isFinite(cpuUsage) || cpuUsage < 0 || cpuUsage > 100) {
                    cpuUsage = 0;
                }
                
                return {
                    ...process,
                    cpuUsage: cpuUsage
                };
            });
            
            tbody.innerHTML = validProcesses.map(process => `
                <tr>
                    <td class="process-pid">${process.pid}</td>
                    <td class="process-name" title="${process.name}">${process.name}</td>
                    <td class="process-cpu">${process.cpuUsage.toFixed(1)}%</td>
                    <td class="process-memory">${formatBytes(process.memoryUsage)}</td>
                    <td>${process.threadCount}</td>
                    <td class="process-user" title="${process.username}">${process.username}</td>
                    <td>
                        <span class="process-state state-running">${process.state}</span>
                    </td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" 
                        title="${process.fullPath || ''}">
                        ${process.fullPath || 'N/A'}
                    </td>
                </tr>
            `).join('');
        }

        function sortProcesses() {
            currentSort = document.getElementById('sortSelect').value;
            sortAndDisplayProcesses();
        }

        function toggleProcessList() {
            const processList = document.getElementById('processList');
            const card = processList.closest('.card');
            card.classList.toggle('collapsed');
        }

        function toggleAllProcesses() {
            showAllProcesses = !showAllProcesses;
            const button = document.querySelector('.show-all-btn');
            button.textContent = showAllProcesses ? 'ÊòæÁ§∫Ââ?20‰∏?ËøõÁ®ã' : 'ÊòæÁ§∫ÂÖ®ÈÉ®ËøõÁ®ã';
            sortAndDisplayProcesses();
        }

        // // º”‘ÿ¥≈≈Ã–≈œ¢
        // async function loadDiskInfo() {
        //     try {
        //         console.log('ø™ º«Î«Û¥≈≈Ã–≈œ¢...');
        //         const response = await fetch('/api/disk/info');
                
        //         if (!response.ok) {
        //             throw new Error(`HTTP¥ÌŒÛ: ${response.status} ${response.statusText}`);
        //         }
                
        //         const data = await response.json();
        //         console.log('¥≈≈ÃAPIœÏ”¶:', data);
                
        //         diskData = data;
        //         document.getElementById('diskCount').textContent = `(${data.partitions ? data.partitions.length : 0} ∏ˆ∑÷«¯)`;
                
        //         displayPartitions(data.partitions || []);
        //         displayDrives(data.drives || []);
                
        //     } catch (error) {
        //         console.error('ªÒ»°¥≈≈Ã–≈œ¢ ß∞‹:', error);
        //         document.getElementById('partitionsTableBody').innerHTML = `
        //             <tr>
        //                 <td colspan="8" style="text-align: center; color: #dc3545; padding: 20px;">
        //                     º”‘ÿ ß∞‹: ${error.message}
        //                 </td>
        //             </tr>
        //         `;
        //     }
            
        //     // º”‘ÿ–‘ƒ‹ ˝æ›
        //     loadDiskPerformance();
        // }

        // // º”‘ÿ¥≈≈Ã–‘ƒ‹ ˝æ›
        // async function loadDiskPerformance() {
        //     try {
        //         console.log('ø™ º«Î«Û¥≈≈Ã–‘ƒ‹ ˝æ›...');
        //         const response = await fetch('/api/disk/performance');
                
        //         if (!response.ok) {
        //             throw new Error(`HTTP¥ÌŒÛ: ${response.status} ${response.statusText}`);
        //         }
                
        //         const data = await response.json();
        //         console.log('¥≈≈Ã–‘ƒ‹APIœÏ”¶:', data);
                
        //         displayPerformance(data.performance || []);
        //     } catch (error) {
        //         console.error('ªÒ»°¥≈≈Ã–‘ƒ‹ ß∞‹:', error);
        //         document.getElementById('performanceContent').innerHTML = `
        //             <p style="text-align: center; color: #dc3545;">
        //                 º”‘ÿ–‘ƒ‹ ˝æ› ß∞‹: ${error.message}
        //             </p>
        //         `;
        //     }
        // }

        // ÂàùÂ?ãÂåñ
        fetchCPUInfo();
        updateCPUUsage();
        loadProcesses();
        loadDiskInfo();
        
        // ÂÆöÊó∂Êõ¥Êñ∞
        setInterval(updateCPUUsage, 1000);
        setInterval(fetchCPUInfo, 30000);
        setInterval(loadProcesses, 5000);
        setInterval(loadDiskInfo, 10000); // 10ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°Á?ÅÁõò‰ø°ÊÅØ
    </script>
</body>
</html>