<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统监控面板</title>
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script> -->
    <!-- 引入Tailwind CSS样式库 -->
    <link rel="stylesheet" href="assets/css/tailwind.min.css">
    <!-- 引入anime.js动画库 -->
    <script src="assets/js/anime.min.js"></script>
    <!-- 引入ECharts图表库 -->
    <script src="assets/js/echarts.min.js"></script>
    <!-- 引入自定义字体样式 -->
    <link href="assets/css/fonts.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#10b981',
                        dark: '#1e293b'
                    }
                }
            }
        }
    </script>
    <style>
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .nav-link.active {
            background-color: #3b82f6;
            color: white;
        }

        .process-table th {
            background-color: #f1f5f9;
        }

        .process-table tr:hover {
            background-color: #f1f5f9;
        }

        .sortable:hover {
            background-color: #e2e8f0 !important;
            cursor: pointer;
        }
    </style>
</head>

<body class="bg-gray-100">
    <div class="flex h-screen">
        <!-- 侧边栏 -->
        <div class="w-64 bg-white shadow-lg">
            <div class="p-4 border-b">
                <h1 class="text-xl font-bold text-gray-800">系统监控面板</h1>
            </div>
            <nav class="p-2">
                <ul>
                    <li class="mb-1">
                        <button class="w-full text-left px-4 py-3 rounded-lg nav-link active"
                            data-tab="home">首页</button>
                    </li>
                    <li class="mb-1">
                        <button class="w-full text-left px-4 py-3 rounded-lg nav-link" data-tab="snapshot">快照信息</button>
                    </li>
                    <li class="mb-1">
                        <button class="w-full text-left px-4 py-3 rounded-lg nav-link" data-tab="registry">注册表</button>
                    </li>
                    <li class="mb-1">
                        <button class="w-full text-left px-4 py-3 rounded-lg nav-link" data-tab="cpu">CPU信息</button>
                    </li>
                    <li class="mb-1">
                        <button class="w-full text-left px-4 py-3 rounded-lg nav-link" data-tab="memory">内存信息</button>
                    </li>
                    <li class="mb-1">
                        <button class="w-full text-left px-4 py-3 rounded-lg nav-link" data-tab="disk">硬盘信息</button>
                    </li>
                    <li class="mb-1">
                        <button class="w-full text-left px-4 py-3 rounded-lg nav-link" data-tab="process">进程信息</button>
                    </li>
                    <li class="mb-1">
                        <button class="w-full text-left px-4 py-3 rounded-lg nav-link" data-tab="driver">驱动信息</button>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- 主内容区 -->
        <div class="flex-1 overflow-auto">
            <!-- 首页 -->
            <div id="home" class="tab-content active p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">系统概览</h2>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">注册表信息</h3>
                        <div class="h-64" id="registryChart"></div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">变化提示</h3>
                        <div class="space-y-4" id="registryChanges">
                            <div class="text-center py-8 text-gray-500">
                                <p>暂无变化信息</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">CPU使用率</h3>
                        <div class="h-48" id="cpuGauge"></div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">内存使用率</h3>
                        <div class="h-48" id="memoryGauge"></div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">硬盘占用</h3>
                        <div class="h-48" id="diskBar"></div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">进程信息</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full process-table">
                            <thead>
                                <tr>
                                    <th class="py-2 px-4 text-left">进程名</th>
                                    <th class="py-2 px-4 text-left">PID</th>
                                    <th class="py-2 px-4 text-left">CPU使用率</th>
                                    <th class="py-2 px-4 text-left">内存使用</th>
                                    <th class="py-2 px-4 text-left">线程数</th>
                                </tr>
                            </thead>
                            <tbody id="processTableBody">
                                <tr>
                                    <td colspan="5" class="py-4 text-center text-gray-500">
                                        加载中...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 快照信息 -->
            <div id="snapshot" class="tab-content p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">快照信息</h2>

                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">快照列表</h3>
                        <button class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg"
                            id="createSnapshotBtn">
                            新增快照
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full process-table">
                            <thead>
                                <tr>
                                    <th class="py-2 px-4 text-left">快照名称</th>
                                    <th class="py-2 px-4 text-left">时间戳</th>
                                    <th class="py-2 px-4 text-left">系统信息</th>
                                    <th class="py-2 px-4 text-left">软件</th>
                                    <th class="py-2 px-4 text-left">网络</th>
                                    <th class="py-2 px-4 text-left">操作</th>
                                </tr>
                            </thead>
                            <tbody id="snapshotTableBody">
                                <tr>
                                    <td colspan="6" class="py-4 text-center text-gray-500">
                                        加载中...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">快照对比</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block mb-2">快照1</label>
                            <select class="w-full p-2 border rounded-lg" id="snapshot1Select">
                                <option value="">请选择快照</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-2">快照2</label>
                            <select class="w-full p-2 border rounded-lg" id="snapshot2Select">
                                <option value="">请选择快照</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-4">
                        <button class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg"
                            id="compareBtn">对比快照</button>
                    </div>
                    <div class="mt-6" id="comparisonResult" style="display: none;">
                        <h4 class="font-medium mb-2">对比结果</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="p-4 bg-blue-50 rounded-lg">
                                <h5 class="font-medium text-blue-700">新增项</h5>
                                <ul class="mt-2 text-sm" id="addedItems"></ul>
                            </div>
                            <div class="p-4 bg-yellow-50 rounded-lg">
                                <h5 class="font-medium text-yellow-700">修改项</h5>
                                <ul class="mt-2 text-sm" id="modifiedItems"></ul>
                            </div>
                            <div class="p-4 bg-red-50 rounded-lg">
                                <h5 class="font-medium text-red-700">删除项</h5>
                                <ul class="mt-2 text-sm" id="removedItems"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 注册表 -->
            <div id="registry" class="tab-content p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">注册表信息</h2>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">当前注册表快照</h3>
                        <button class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg"
                            id="refreshRegistryBtn">
                            刷新
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full process-table">
                            <thead>
                                <tr>
                                    <th class="py-2 px-4 text-left">类型</th>
                                    <th class="py-2 px-4 text-left">路径</th>
                                    <th class="py-2 px-4 text-left">子项数量</th>
                                    <th class="py-2 px-4 text-left">值数量</th>
                                </tr>
                            </thead>
                            <tbody id="registryTableBody">
                                <tr>
                                    <td colspan="4" class="py-4 text-center text-gray-500">
                                        加载中...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- CPU信息 -->
            <div id="cpu" class="tab-content p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">CPU信息</h2>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">

                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">CPU当前使用率</h3>
                            <!-- CPU监控控制 -->
                            <div class="flex items-center space-x-2">
                                <button id="cpuRefreshToggle"
                                    class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                    暂停刷新
                                </button>
                                <div class="flex items-center">
                                    <label class="mr-1 text-sm">间隔:</label>
                                    <select id="cpuRefreshInterval" class="p-1 border rounded text-sm">
                                        <option value="1000" selected>1秒</option>
                                        <option value="3000">3秒</option>
                                        <option value="10000">10秒</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="flex">
                            <div class="h-64 flex-1" id="cpuUsageGauge"></div>
                            <div class="flex items-center justify-center w-32">
                                <div id="cpuStatus" class="text-center">
                                    <p class="text-lg font-semibold" id="cpuStatusText">良好</p>
                                    <p class="text-sm text-gray-500" id="cpuStatusDescription">CPU使用率正常</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">CPU详细信息</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full process-table">
                                <tbody id="cpuInfoTable">
                                    <tr>
                                        <td colspan="2" class="py-4 text-center text-gray-500">
                                            加载中...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">CPU历史使用率</h3>
                    <div class="h-80" id="cpuHistoryChart"></div>
                </div>
            </div>

            <!-- 内存信息 -->
            <div id="memory" class="tab-content p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">内存信息</h2>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">内存使用情况</h3>
                            <!-- 内存监控控制 -->
                            <div class="flex items-center space-x-2">
                                <button id="memoryRefreshToggle"
                                    class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                    暂停刷新
                                </button>
                                <div class="flex items-center">
                                    <label class="mr-1 text-sm">间隔:</label>
                                    <select id="memoryRefreshInterval" class="p-1 border rounded text-sm">
                                        <option value="1000">1秒</option>
                                        <option value="2000" selected>2秒</option>
                                        <option value="5000">5秒</option>
                                        <option value="10000">10秒</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="flex">
                            <div class="h-64 flex-1" id="memoryUsageGauge"></div>
                            <div class="flex items-center justify-center w-32">
                                <div id="memoryStatus" class="text-center">
                                    <p class="text-lg font-semibold" id="memoryStatusText">良好</p>
                                    <p class="text-sm text-gray-500" id="memoryStatusDescription">内存使用率正常</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">内存详细信息</h3>
                        <div class="space-y-4">
                            <div>
                                <p class="text-gray-600">总内存</p>
                                <p class="text-xl font-semibold" id="totalMemory">-</p>
                            </div>
                            <div>
                                <p class="text-gray-600">已用内存</p>
                                <p class="text-xl font-semibold" id="usedMemory">-</p>
                            </div>
                            <div>
                                <p class="text-gray-600">可用内存</p>
                                <p class="text-xl font-semibold" id="availableMemory">-</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">内存历史使用率</h3>
                    <div class="h-80" id="memoryHistoryChart"></div>
                </div>
            </div>

            <!-- 硬盘信息 -->
            <div id="disk" class="tab-content p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">硬盘信息</h2>

                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">硬盘列表</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full process-table">
                            <thead>
                                <tr>
                                    <th class="py-2 px-4 text-left">设备ID</th>
                                    <th class="py-2 px-4 text-left">型号</th>
                                    <th class="py-2 px-4 text-left">总大小</th>
                                    <th class="py-2 px-4 text-left">已用空间</th>
                                    <th class="py-2 px-4 text-left">可用空间</th>
                                    <th class="py-2 px-4 text-left">使用率</th>
                                </tr>
                            </thead>
                            <tbody id="diskTableBody">
                                <tr>
                                    <td colspan="6" class="py-4 text-center text-gray-500">
                                        加载中...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 添加磁盘使用情况饼图区域 -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">磁盘使用情况</h3>
                    </div>
                    <div id="diskUsageCharts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>

                <!-- 修改硬盘性能部分 -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">硬盘读写速度</h3>
                        <!-- 硬盘监控控制 -->
                        <div class="flex items-center space-x-2">
                            <button id="diskRefreshToggle"
                                class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                暂停刷新
                            </button>
                            <div class="flex items-center">
                                <label class="mr-1 text-sm">间隔:</label>
                                <select id="diskRefreshInterval" class="p-1 border rounded text-sm">
                                    <option value="1000">1秒</option>
                                    <option value="2000" selected>2秒</option>
                                    <option value="5000">5秒</option>
                                    <option value="10000">10秒</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div id="diskPerformanceCharts" class="grid grid-cols-1 gap-4"></div>
                </div>
            </div>

            <!-- 进程信息 -->
            <!-- 修改进程信息部分 -->
            <div id="process" class="tab-content p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">进程信息</h2>

                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <div class="flex items-center space-x-4">
                            <div class="text-lg">
                                总进程数: <span id="totalProcessCount" class="font-semibold">0</span>
                            </div>
                            <div class="text-lg">
                                总线程数: <span id="totalThreadCount" class="font-semibold">0</span>
                            </div>
                        </div>

                        <div class="flex items-center space-x-4">
                            <div class="flex items-center">
                                <label class="mr-2 text-sm">显示数量:</label>
                                <select id="processDisplayCount" class="p-1 border rounded text-sm">
                                    <option value="20">20条</option>
                                    <option value="50" selected>50条</option>
                                    <option value="100">100条</option>
                                    <option value="all">全部</option>
                                </select>
                            </div>

                            <div class="flex items-center">
                                <button id="processRefreshToggle"
                                    class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                    暂停刷新
                                </button>
                                <div class="flex items-center ml-2">
                                    <label class="mr-1 text-sm">间隔:</label>
                                    <select id="processRefreshInterval" class="p-1 border rounded text-sm">
                                        <option value="1000">1秒</option>
                                        <option value="2000" selected>2秒</option>
                                        <option value="5000">5秒</option>
                                        <option value="10000">10秒</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">进程列表</h3>
                        <div>
                            <input type="text" placeholder="搜索进程..." class="p-2 border rounded-lg" id="processSearch">
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full process-table">
                            <thead>
                                <tr>
                                    <th class="py-2 px-4 text-left sortable" data-sort="name">进程名 ↑↓</th>
                                    <th class="py-2 px-4 text-left sortable" data-sort="pid">PID ↑↓</th>
                                    <th class="py-2 px-4 text-left sortable" data-sort="cpu">CPU使用率 ↑↓</th>
                                    <th class="py-2 px-4 text-left sortable" data-sort="memory">内存使用 ↑↓</th>
                                    <th class="py-2 px-4 text-left">线程数</th>
                                    <th class="py-2 px-4 text-left">状态</th>
                                    <th class="py-2 px-4 text-left">操作</th>
                                </tr>
                            </thead>
                            <tbody id="processListTableBody">
                                <tr>
                                    <td colspan="7" class="py-4 text-center text-gray-500">
                                        加载中...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 进程详情模态窗口 -->
            <div id="processDetailModal"
                class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
                <div class="bg-white rounded-lg shadow-lg w-1/2 max-h-[90vh] overflow-y-auto">
                    <div class="border-b p-4 flex justify-between items-center">
                        <h3 class="text-lg font-semibold">进程详情</h3>
                        <button id="closeProcessDetailModal" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12">
                                </path>
                            </svg>
                        </button>
                    </div>
                    <div class="p-6" id="processDetailContent">
                        <!-- 进程详情内容将在这里显示 -->
                    </div>
                </div>
            </div>

            <!-- 驱动信息 -->
            <div id="driver" class="tab-content p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">驱动信息</h2>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">驱动统计</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between">
                                <span>总驱动数</span>
                                <span class="font-semibold" id="totalDrivers">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span>运行中</span>
                                <span class="font-semibold text-green-600" id="runningDrivers">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span>已停止</span>
                                <span class="font-semibold text-red-600" id="stoppedDrivers">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span>第三方驱动</span>
                                <span class="font-semibold" id="thirdPartyDrivers">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6 lg:col-span-2">
                        <h3 class="text-lg font-semibold mb-4">驱动类型分布</h3>
                        <div class="h-48" id="driverTypeChart"></div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">驱动列表</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full process-table">
                            <thead>
                                <tr>
                                    <th class="py-2 px-4 text-left">驱动名称</th>
                                    <th class="py-2 px-4 text-left">显示名称</th>
                                    <th class="py-2 px-4 text-left">路径</th>
                                    <th class="py-2 px-4 text-left">类型</th>
                                    <th class="py-2 px-4 text-left">状态</th>
                                    <th class="py-2 px-4 text-left">启动类型</th>
                                </tr>
                            </thead>
                            <tbody id="driverTableBody">
                                <tr>
                                    <td colspan="6" class="py-4 text-center text-gray-500">
                                        加载中...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 当前活动的标签
        let activeTab = 'home';

        // 初始化图表
        let charts = {};

        // 进程排序状态
        let processSort = {
            field: 'pid',
            direction: 'asc'
        };

        // CPU监控相关变量
        let cpuRefreshInterval = 1000; // 默认1秒
        let cpuRefreshEnabled = true;
        let cpuRefreshTimer = null;

        // 内存监控相关变量
        let memoryRefreshInterval = 2000; // 默认2秒
        let memoryRefreshEnabled = true;
        let memoryRefreshTimer = null;

        // 硬盘监控相关变量
        let diskRefreshInterval = 2000; // 默认2秒
        let diskRefreshEnabled = true;
        let diskRefreshTimer = null;
        let diskCharts = {}; // 存储磁盘图表实例

        // 进程监控相关变量
        let processRefreshInterval = 2000; // 默认2秒
        let processRefreshEnabled = true;
        let processRefreshTimer = null;
        let processDisplayCount = 50; // 默认显示50条

        // API基础URL
        const API_BASE = '/api';

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function () {
            // 设置标签切换事件
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function () {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });

            // 初始化首页图表
            initHomeCharts();

            // 绑定事件
            bindEvents();

            // 加载首页数据
            loadDashboardData();

                // 初始化进程相关事件
            bindProcessEvents();

            // 启动进程数据自动刷新（如果已启用）
            if (processRefreshEnabled) {
                startProcessRefresh();
            }

        });

        // 绑定事件
        function bindEvents() {
            // 快照相关事件
            document.getElementById('createSnapshotBtn').addEventListener('click', createSnapshot);
            document.getElementById('compareBtn').addEventListener('click', compareSnapshots);

            // 注册表相关事件
            document.getElementById('refreshRegistryBtn').addEventListener('click', loadRegistryData);

            // 进程搜索事件
            document.getElementById('processSearch').addEventListener('input', function () {
                loadProcessData(this.value);
            });

            // 进程排序事件
            document.querySelectorAll('.sortable').forEach(th => {
                th.addEventListener('click', function () {
                    const field = this.getAttribute('data-sort');
                    sortProcesses(field);
                });
            });

            // CPU监控控制事件
            document.getElementById('cpuRefreshToggle').addEventListener('click', toggleCpuRefresh);
            document.getElementById('cpuRefreshInterval').addEventListener('change', changeCpuRefreshInterval);

            // 内存监控控制事件
            document.getElementById('memoryRefreshToggle').addEventListener('click', toggleMemoryRefresh);
            document.getElementById('memoryRefreshInterval').addEventListener('change', changeMemoryRefreshInterval);

            // 硬盘监控控制事件
            document.getElementById('diskRefreshToggle').addEventListener('click', toggleDiskRefresh);
            document.getElementById('diskRefreshInterval').addEventListener('change', changeDiskRefreshInterval);
        }

        // 切换标签
        function switchTab(tabId) {
            // 隐藏所有标签内容
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // 移除所有导航链接的活动状态
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // 显示目标标签内容
            document.getElementById(tabId).classList.add('active');

            // 设置导航链接为活动状态
            document.querySelector(`.nav-link[data-tab="${tabId}"]`).classList.add('active');

            // 根据标签初始化相应内容
            switch (tabId) {
                case 'cpu':
                    initCpuCharts();
                    loadCpuData();
                    if (cpuRefreshEnabled) {
                        startCpuRefresh();
                    }
                    break;
                case 'memory':
                    initMemoryCharts();
                    loadMemoryData();
                    if (memoryRefreshEnabled) {
                        startMemoryRefresh();
                    }
                    break;
                case 'disk':
                    initDiskCharts();
                    loadDiskData();
                    if (diskRefreshEnabled) {
                        startDiskRefresh();
                    }
                    break;
                case 'process':
                    loadProcessData();
                    break;
                case 'driver':
                    initDriverCharts();
                    loadDriverData();
                    break;
                case 'snapshot':
                    loadSnapshotData();
                    break;
                case 'registry':
                    loadRegistryData();
                    break;
            }

            activeTab = tabId;
        }

        // 初始化首页图表
        function initHomeCharts() {
            // 注册表图表
            charts.registryChart = echarts.init(document.getElementById('registryChart'));
            charts.registryChart.setOption({
                tooltip: {
                    trigger: 'item'
                },
                legend: {
                    top: '5%',
                    left: 'center'
                },
                series: [
                    {
                        name: '注册表项',
                        type: 'pie',
                        radius: ['40%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '18',
                                fontWeight: 'bold'
                            }
                        },
                        labelLine: {
                            show: false
                        },
                        data: [
                            { value: 0, name: '系统信息' },
                            { value: 0, name: '软件' },
                            { value: 0, name: '网络' },
                            { value: 0, name: '自启动' }
                        ]
                    }
                ]
            });

            // CPU仪表盘
            charts.cpuGauge = echarts.init(document.getElementById('cpuGauge'));
            charts.cpuGauge.setOption({
                series: [
                    {
                        type: 'gauge',
                        progress: {
                            show: true,
                            width: 18
                        },
                        axisLine: {
                            lineStyle: {
                                width: 18
                            }
                        },
                        axisTick: {
                            show: false
                        },
                        splitLine: {
                            length: 15,
                            lineStyle: {
                                width: 2,
                                color: '#999'
                            }
                        },
                        axisLabel: {
                            distance: 25,
                            color: '#999',
                            fontSize: 10
                        },
                        anchor: {
                            show: true,
                            showAbove: true,
                            size: 25,
                            itemStyle: {
                                borderWidth: 10
                            }
                        },
                        title: {
                            show: false
                        },
                        detail: {
                            valueAnimation: true,
                            fontSize: 20,
                            formatter: '{value}%'
                        },
                        data: [
                            {
                                value: 0
                            }
                        ]
                    }
                ]
            });

            // 内存仪表盘
            charts.memoryGauge = echarts.init(document.getElementById('memoryGauge'));
            charts.memoryGauge.setOption({
                series: [
                    {
                        type: 'gauge',
                        progress: {
                            show: true,
                            width: 18
                        },
                        axisLine: {
                            lineStyle: {
                                width: 18,
                                color: [
                                    [0.3, '#67e0e3'],
                                    [0.7, '#37a2da'],
                                    [1, '#fd666d']
                                ]
                            }
                        },
                        axisTick: {
                            show: false
                        },
                        splitLine: {
                            length: 15,
                            lineStyle: {
                                width: 2,
                                color: '#999'
                            }
                        },
                        axisLabel: {
                            distance: 25,
                            color: '#999',
                            fontSize: 10
                        },
                        anchor: {
                            show: true,
                            showAbove: true,
                            size: 25,
                            itemStyle: {
                                borderWidth: 10
                            }
                        },
                        title: {
                            show: false
                        },
                        detail: {
                            valueAnimation: true,
                            fontSize: 20,
                            formatter: '{value}%'
                        },
                        data: [
                            {
                                value: 0
                            }
                        ]
                    }
                ]
            });

            // 硬盘条状图
            charts.diskBar = echarts.init(document.getElementById('diskBar'));
            charts.diskBar.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'value',
                    boundaryGap: [0, 0.01]
                },
                yAxis: {
                    type: 'category',
                    data: []
                },
                series: [
                    {
                        name: '使用率',
                        type: 'bar',
                        data: []
                    }
                ]
            });
        }

        // 初始化CPU图表
        function initCpuCharts() {
            if (!charts.cpuUsageGauge) {
                charts.cpuUsageGauge = echarts.init(document.getElementById('cpuUsageGauge'));
                charts.cpuUsageGauge.setOption({
                    series: [
                        {
                            type: 'gauge',
                            progress: {
                                show: true,
                                width: 18
                            },
                            axisLine: {
                                lineStyle: {
                                    width: 18
                                }
                            },
                            axisTick: {
                                show: false
                            },
                            splitLine: {
                                length: 15,
                                lineStyle: {
                                    width: 2,
                                    color: '#999'
                                }
                            },
                            axisLabel: {
                                distance: 25,
                                color: '#999',
                                fontSize: 10
                            },
                            anchor: {
                                show: true,
                                showAbove: true,
                                size: 25,
                                itemStyle: {
                                    borderWidth: 10
                                }
                            },
                            title: {
                                show: false
                            },
                            detail: {
                                valueAnimation: true,
                                fontSize: 20,
                                formatter: '{value}%'
                            },
                            data: [
                                {
                                    value: 0
                                }
                            ]
                        }
                    ]
                });
            }

            if (!charts.cpuHistoryChart) {
                charts.cpuHistoryChart = echarts.init(document.getElementById('cpuHistoryChart'));
                charts.cpuHistoryChart.setOption({
                    tooltip: {
                        trigger: 'axis',
                        formatter: function (params) {
                            params = params[0];
                            const date = new Date(params.value[0]);
                            return date.toLocaleString() + '<br/>'
                                + params.seriesName + ': ' + params.value[1].toFixed(2) + '%';
                        },
                        axisPointer: {
                            animation: false
                        }
                    },
                    xAxis: {
                        type: 'time',
                        splitLine: {
                            show: false
                        }
                    },
                    yAxis: {
                        type: 'value',
                        boundaryGap: [0, '100%'],
                        splitLine: {
                            show: false
                        },
                        max: 100
                    },
                    series: [
                        {
                            name: 'CPU使用率',
                            type: 'line',
                            showSymbol: false,
                            data: []
                        },
                        {
                            name: '危险阈值',
                            type: 'line',
                            markLine: {
                                silent: true,
                                symbol: 'none',
                                label: {
                                    position: 'middle',
                                    formatter: '危险(95%)'
                                },
                                lineStyle: {
                                    color: 'red',
                                    width: 2,
                                    type: 'dashed'
                                },
                                data: [{
                                    yAxis: 95
                                }]
                            }
                        },
                        {
                            name: '警告阈值',
                            type: 'line',
                            markLine: {
                                silent: true,
                                symbol: 'none',
                                label: {
                                    position: 'middle',
                                    formatter: '警告(80%)'
                                },
                                lineStyle: {
                                    color: 'orange',
                                    width: 2,
                                    type: 'dashed'
                                },
                                data: [{
                                    yAxis: 80
                                }]
                            }
                        }
                    ]
                });
            }
        }

        // 初始化内存图表
        function initMemoryCharts() {
            if (!charts.memoryUsageGauge) {
                charts.memoryUsageGauge = echarts.init(document.getElementById('memoryUsageGauge'));
                charts.memoryUsageGauge.setOption({
                    series: [
                        {
                            type: 'gauge',
                            progress: {
                                show: true,
                                width: 18
                            },
                            axisLine: {
                                lineStyle: {
                                    width: 18,
                                    color: [
                                        [0.3, '#67e0e3'],
                                        [0.7, '#37a2da'],
                                        [1, '#fd666d']
                                    ]
                                }
                            },
                            axisTick: {
                                show: false
                            },
                            splitLine: {
                                length: 15,
                                lineStyle: {
                                    width: 2,
                                    color: '#999'
                                }
                            },
                            axisLabel: {
                                distance: 25,
                                color: '#999',
                                fontSize: 10
                            },
                            anchor: {
                                show: true,
                                showAbove: true,
                                size: 25,
                                itemStyle: {
                                    borderWidth: 10
                                }
                            },
                            title: {
                                show: false
                            },
                            detail: {
                                valueAnimation: true,
                                fontSize: 20,
                                formatter: '{value}%'
                            },
                            data: [
                                {
                                    value: 0
                                }
                            ]
                        }
                    ]
                });
            }

            if (!charts.memoryHistoryChart) {
                charts.memoryHistoryChart = echarts.init(document.getElementById('memoryHistoryChart'));
                charts.memoryHistoryChart.setOption({
                    tooltip: {
                        trigger: 'axis',
                        formatter: function (params) {
                            params = params[0];
                            const date = new Date(params.value[0]);
                            return date.toLocaleString() + '<br/>'
                                + params.seriesName + ': ' + params.value[1].toFixed(2) + '%';
                        },
                        axisPointer: {
                            animation: false
                        }
                    },
                    xAxis: {
                        type: 'time',
                        splitLine: {
                            show: false
                        }
                    },
                    yAxis: {
                        type: 'value',
                        boundaryGap: [0, '100%'],
                        splitLine: {
                            show: false
                        },
                        max: 100
                    },
                    series: [
                        {
                            name: '内存使用率',
                            type: 'line',
                            showSymbol: false,
                            data: []
                        },
                        {
                            name: '危险阈值',
                            type: 'line',
                            markLine: {
                                silent: true,
                                symbol: 'none',
                                label: {
                                    position: 'middle',
                                    formatter: '危险(80%)'
                                },
                                lineStyle: {
                                    color: 'red',
                                    width: 2,
                                    type: 'dashed'
                                },
                                data: [{
                                    yAxis: 80
                                }]
                            }
                        },
                        {
                            name: '警告阈值',
                            type: 'line',
                            markLine: {
                                silent: true,
                                symbol: 'none',
                                label: {
                                    position: 'middle',
                                    formatter: '警告(60%)'
                                },
                                lineStyle: {
                                    color: 'orange',
                                    width: 2,
                                    type: 'dashed'
                                },
                                data: [{
                                    yAxis: 60
                                }]
                            }
                        }
                    ]
                });
            }
        }

        // 初始化硬盘图表
        function initDiskCharts() {
            // 磁盘性能图表容器将在loadDiskData中动态创建
        }

        // 初始化驱动图表
        function initDriverCharts() {
            if (!charts.driverTypeChart) {
                charts.driverTypeChart = echarts.init(document.getElementById('driverTypeChart'));
                charts.driverTypeChart.setOption({
                    tooltip: {
                        trigger: 'item'
                    },
                    legend: {
                        top: '5%',
                        left: 'center'
                    },
                    series: [
                        {
                            name: '驱动类型',
                            type: 'pie',
                            radius: ['40%', '70%'],
                            avoidLabelOverlap: false,
                            itemStyle: {
                                borderRadius: 10,
                                borderColor: '#fff',
                                borderWidth: 2
                            },
                            label: {
                                show: false,
                                position: 'center'
                            },
                            emphasis: {
                                label: {
                                    show: true,
                                    fontSize: '18',
                                    fontWeight: 'bold'
                                }
                            },
                            labelLine: {
                                show: false
                            },
                            data: [
                                { value: 0, name: '内核驱动' },
                                { value: 0, name: '文件系统' },
                                { value: 0, name: '自启动' },
                                { value: 0, name: '第三方' }
                            ]
                        }
                    ]
                });
            }
        }

        // 加载仪表板数据
        function loadDashboardData() {
            // 加载CPU信息
            fetch(`${API_BASE}/cpu/info`)
                .then(response => response.json())
                .then(data => {
                    // 更新CPU信息显示
                })
                .catch(err => console.error('加载CPU信息失败:', err));

            // 加载CPU使用率
            fetch(`${API_BASE}/cpu/usage`)
                .then(response => response.json())
                .then(data => {
                    charts.cpuGauge.setOption({
                        series: [{
                            data: [{ value: data.usage }]
                        }]
                    });
                })
                .catch(err => console.error('加载CPU使用率失败:', err));

            // 加载内存使用率
            fetch(`${API_BASE}/memory/usage`)
                .then(response => response.json())
                .then(data => {
                    const percent = data.usedPercent;
                    charts.memoryGauge.setOption({
                        series: [{
                            data: [{ value: percent }]
                        }]
                    });

                    // 更新内存详细信息
                    document.getElementById('totalMemory').textContent = formatBytes(data.totalPhysical);
                    document.getElementById('usedMemory').textContent = formatBytes(data.usedPhysical);
                    document.getElementById('availableMemory').textContent = formatBytes(data.availablePhysical);
                })
                .catch(err => console.error('加载内存使用率失败:', err));

            // 加载硬盘信息
            fetch(`${API_BASE}/disk/info`)
                .then(response => response.json())
                .then(data => {
                    const partitions = data.partitions;
                    const driveLetters = partitions.map(p => p.driveLetter);
                    const usagePercentages = partitions.map(p => p.usagePercentage);

                    charts.diskBar.setOption({
                        yAxis: {
                            data: driveLetters
                        },
                        series: [{
                            data: usagePercentages
                        }]
                    });
                })
                .catch(err => console.error('加载硬盘信息失败:', err));

            // 加载进程数据
            loadProcessData();
        }

        // 加载CPU数据
        function loadCpuData() {
            // CPU信息表格
            fetch(`${API_BASE}/cpu/info`)
                .then(response => response.json())
                .then(data => {
                    const cpuInfoTable = document.getElementById('cpuInfoTable');
                    cpuInfoTable.innerHTML = `
                        <tr>
                            <td class="py-2 px-4 border-b font-medium">架构</td>
                            <td class="py-2 px-4 border-b">${data.architecture}</td>
                        </tr>
                        <tr>
                            <td class="py-2 px-4 border-b font-medium">名称</td>
                            <td class="py-2 px-4 border-b">${data.name}</td>
                        </tr>
                        <tr>
                            <td class="py-2 px-4 border-b font-medium">基础频率</td>
                            <td class="py-2 px-4 border-b">${data.baseFrequency} MHz</td>
                        </tr>
                        <tr>
                            <td class="py-2 px-4 border-b font-medium">最大频率</td>
                            <td class="py-2 px-4 border-b">${Math.round(data.maxFrequency / 1000000)} MHz</td>
                        </tr>
                        <tr>
                            <td class="py-2 px-4 border-b font-medium">物理核心数</td>
                            <td class="py-2 px-4 border-b">${data.physicalCores}</td>
                        </tr>
                        <tr>
                            <td class="py-2 px-4 border-b font-medium">逻辑核心数</td>
                            <td class="py-2 px-4 border-b">${data.logicalCores}</td>
                        </tr>
                    `;
                })
                .catch(err => {
                    console.error('加载CPU信息失败:', err);
                    document.getElementById('cpuInfoTable').innerHTML = `
                        <tr>
                            <td colspan="2" class="py-4 text-center text-red-500">
                                加载失败: ${err.message}
                            </td>
                        </tr>
                    `;
                });

            // CPU当前使用率
            fetch(`${API_BASE}/cpu/usage`)
                .then(response => response.json())
                .then(data => {
                    charts.cpuUsageGauge.setOption({
                        series: [{
                            data: [{ value: data.usage.toFixed(2) }]
                        }]
                    });
                })
                .catch(err => console.error('加载CPU使用率失败:', err));

            // CPU历史数据图表
            fetch(`${API_BASE}/cpu/history`)
                .then(response => response.json())
                .then(data => {
                    const chartData = data.map(item => [item.timestamp, item.value]);
                    charts.cpuHistoryChart.setOption({
                        series: [{
                            data: chartData
                        }]
                    });
                })
                .catch(err => console.error('加载CPU历史数据失败:', err));

            // 启动CPU数据自动刷新（如果已启用）
            if (cpuRefreshEnabled) {
                startCpuRefresh();
            }
        }

        // 加载内存数据
        function loadMemoryData() {
            // 内存使用情况
            fetch(`${API_BASE}/memory/usage`)
                .then(response => response.json())
                .then(data => {
                    const percent = data.usedPercent;
                    charts.memoryUsageGauge.setOption({
                        series: [{
                            data: [{ value: percent }]
                        }]
                    });

                    // 更新内存状态显示
                    updateMemoryStatus(percent);

                    // 更新内存详细信息
                    document.getElementById('totalMemory').textContent = formatBytes(data.totalPhysical);
                    document.getElementById('usedMemory').textContent = formatBytes(data.usedPhysical);
                    document.getElementById('availableMemory').textContent = formatBytes(data.availablePhysical);
                })
                .catch(err => console.error('加载内存使用情况失败:', err));

            // 内存历史数据图表
            fetch(`${API_BASE}/memory/history`)
                .then(response => response.json())
                .then(data => {
                    const chartData = data.map(item => [item.timestamp, item.value]);
                    charts.memoryHistoryChart.setOption({
                        series: [{
                            data: chartData
                        }]
                    });
                })
                .catch(err => console.error('加载内存历史数据失败:', err));

            // 启动内存数据自动刷新（如果已启用）
            if (memoryRefreshEnabled) {
                startMemoryRefresh();
            }
        }
        // 添加更新内存状态显示的函数
        function updateMemoryStatus(usage) {
            const statusText = document.getElementById('memoryStatusText');
            const statusDescription = document.getElementById('memoryStatusDescription');

            if (usage > 80) {
                statusText.textContent = '危险';
                statusText.className = 'text-lg font-semibold text-red-600';
                statusDescription.textContent = '内存使用率过高';
                statusDescription.className = 'text-sm text-red-500';
            } else if (usage > 60) {
                statusText.textContent = '警告';
                statusText.className = 'text-lg font-semibold text-orange-500';
                statusDescription.textContent = '内存使用率较高';
                statusDescription.className = 'text-sm text-orange-400';
            } else {
                statusText.textContent = '良好';
                statusText.className = 'text-lg font-semibold text-green-600';
                statusDescription.textContent = '内存使用率正常';
                statusDescription.className = 'text-sm text-gray-500';
            }
        }
        // 加载硬盘数据
        function loadDiskData() {
            // 硬盘列表
            fetch(`${API_BASE}/disk/info`)
                .then(response => response.json())
                .then(data => {
                    const diskTableBody = document.getElementById('diskTableBody');
                    diskTableBody.innerHTML = data.partitions.map(partition => `
                <tr>
                    <td class="py-2 px-4 border-b">${partition.driveLetter}</td>
                    <td class="py-2 px-4 border-b">${partition.label}</td>
                    <td class="py-2 px-4 border-b">${formatBytes(partition.totalSize)}</td>
                    <td class="py-2 px-4 border-b">${formatBytes(partition.usedSpace)}</td>
                    <td class="py-2 px-4 border-b">${formatBytes(partition.freeSpace)}</td>
                    <td class="py-2 px-4 border-b">${partition.usagePercentage.toFixed(2)}%</td>
                </tr>
            `).join('');

                    // 创建磁盘使用情况饼图
                    createDiskUsageCharts(data.partitions);
                })
                .catch(err => {
                    console.error('加载硬盘列表失败:', err);
                    document.getElementById('diskTableBody').innerHTML = `
                <tr>
                    <td colspan="6" class="py-4 text-center text-red-500">
                        加载失败: ${err.message}
                    </td>
                </tr>
            `;
                });

            // 硬盘性能图表
            fetch(`${API_BASE}/disk/performance`)
                .then(response => response.json())
                .then(data => {
                    const performance = data.performance;

                    // 创建每个磁盘的读写速度折线图
                    createDiskPerformanceCharts(performance);
                })
                .catch(err => console.error('加载硬盘性能失败:', err));

            // 启动硬盘数据自动刷新（如果已启用）
            if (diskRefreshEnabled) {
                startDiskRefresh();
            }
        }
        // 创建磁盘使用情况饼图
        function createDiskUsageCharts(partitions) {
            const container = document.getElementById('diskUsageCharts');
            container.innerHTML = ''; // 清空现有内容

            partitions.forEach(partition => {
                // 创建图表容器
                const chartContainer = document.createElement('div');
                chartContainer.className = 'p-4';
                chartContainer.innerHTML = `
            <h4 class="font-medium text-center mb-2">${partition.driveLetter} 使用情况</h4>
            <div id="diskUsageChart-${partition.driveLetter}" class="h-48"></div>
        `;
                container.appendChild(chartContainer);

                // 初始化图表
                const chartDom = document.getElementById(`diskUsageChart-${partition.driveLetter}`);
                const chart = echarts.init(chartDom);

                // 根据使用率确定颜色和状态
                let color, status;
                if (partition.usagePercentage > 90) {
                    color = '#ef4444'; // 红色 - 危险
                    status = '危险';
                } else if (partition.usagePercentage > 70) {
                    color = '#f97316'; // 橙色 - 警告
                    status = '警告';
                } else {
                    color = '#22c55e'; // 绿色 - 良好
                    status = '良好';
                }

                chart.setOption({
                    tooltip: {
                        trigger: 'item',
                        formatter: `{a} <br/>{b}: {c}GB ({d}%)`
                    },
                    series: [
                        {
                            name: `${partition.driveLetter} 使用情况`,
                            type: 'pie',
                            radius: ['40%', '70%'],
                            avoidLabelOverlap: false,
                            itemStyle: {
                                borderRadius: 10,
                                borderColor: '#fff',
                                borderWidth: 2
                            },
                            label: {
                                show: true,
                                position: 'center',
                                formatter: `${status}\n${partition.usagePercentage.toFixed(1)}%`,
                                fontSize: 14,
                                fontWeight: 'bold'
                            },
                            labelLine: {
                                show: false
                            },
                            data: [
                                {
                                    value: (partition.usedSpace / (1024 ** 3)).toFixed(2), // 转换为GB
                                    name: '已使用',
                                    itemStyle: { color: color }
                                },
                                {
                                    value: (partition.freeSpace / (1024 ** 3)).toFixed(2), // 转换为GB
                                    name: '可用空间',
                                    itemStyle: { color: '#cbd5e1' }
                                }
                            ]
                        }
                    ]
                });

                // 保存图表实例
                diskCharts[`usage-${partition.driveLetter}`] = chart;
            });
        }


        // 创建磁盘性能折线图
        function createDiskPerformanceCharts(performanceData) {
            const container = document.getElementById('diskPerformanceCharts');
            container.innerHTML = ''; // 清空现有内容

            performanceData.forEach(disk => {
                // 创建图表容器
                const chartContainer = document.createElement('div');
                chartContainer.className = 'p-4 border rounded mb-4';
                chartContainer.innerHTML = `
            <h4 class="font-medium mb-2">${disk.driveLetter} 读写速度</h4>
            <div id="diskPerformanceChart-${disk.driveLetter}" class="h-64"></div>
        `;
                container.appendChild(chartContainer);

                // 初始化图表
                const chartDom = document.getElementById(`diskPerformanceChart-${disk.driveLetter}`);
                const chart = echarts.init(chartDom);

                chart.setOption({
                    tooltip: {
                        trigger: 'axis'
                    },
                    legend: {
                        data: ['读取速度 (KB/s)', '写入速度 (KB/s)']
                    },
                    xAxis: {
                        type: 'category',
                        data: [] // 时间轴数据将在更新时填充
                    },
                    yAxis: {
                        type: 'value',
                        name: 'KB/s'
                    },
                    series: [
                        {
                            name: '读取速度 (KB/s)',
                            type: 'line',
                            data: [],
                            smooth: true
                        },
                        {
                            name: '写入速度 (KB/s)',
                            type: 'line',
                            data: [],
                            smooth: true
                        }
                    ]
                });

                // 保存图表实例
                diskCharts[`performance-${disk.driveLetter}`] = chart;
            });

            // 更新图表数据
            updateDiskPerformanceChartData(performanceData);
        }

        // 更新磁盘性能图表数据
        function updateDiskPerformanceChartData(performanceData) {
            performanceData.forEach(disk => {
                const chart = diskCharts[`performance-${disk.driveLetter}`];
                if (chart) {
                    // 获取当前图表选项
                    const option = chart.getOption();

                    // 初始化数据数组（如果为空）
                    if (!option.xAxis[0].data.length) {
                        option.xAxis[0].data = Array(20).fill(0).map((_, i) => {
                            const time = new Date(Date.now() - (19 - i) * 2000);
                            return `${time.getHours()}:${time.getMinutes().toString().padStart(2, '0')}:${time.getSeconds().toString().padStart(2, '0')}`;
                        });

                        option.series[0].data = Array(20).fill(0);
                        option.series[1].data = Array(20).fill(0);
                    }

                    // 更新数据（移除第一个元素，添加新数据）
                    option.xAxis[0].data.shift();
                    const now = new Date();
                    option.xAxis[0].data.push(`${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`);

                    option.series[0].data.shift();
                    option.series[0].data.push(Math.round(disk.readBytesPerSec / 1024));

                    option.series[1].data.shift();
                    option.series[1].data.push(Math.round(disk.writeBytesPerSec / 1024));

                    // 应用更新
                    chart.setOption(option);
                }
            });
        }

        // 硬盘刷新控制函数
        function toggleDiskRefresh() {
            diskRefreshEnabled = !diskRefreshEnabled;
            const toggleBtn = document.getElementById('diskRefreshToggle');

            if (diskRefreshEnabled) {
                toggleBtn.textContent = '暂停刷新';
                toggleBtn.className = 'bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm';
                startDiskRefresh();
            } else {
                toggleBtn.textContent = '开始刷新';
                toggleBtn.className = 'bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm';
                stopDiskRefresh();
            }
        }

        function changeDiskRefreshInterval() {
            diskRefreshInterval = parseInt(document.getElementById('diskRefreshInterval').value);
            if (diskRefreshEnabled) {
                stopDiskRefresh();
                startDiskRefresh();
            }
        }

        function startDiskRefresh() {
            stopDiskRefresh(); // 先清除已有的定时器
            diskRefreshTimer = setInterval(() => {
                updateDiskUsageData();
            }, diskRefreshInterval);
        }

        function stopDiskRefresh() {
            if (diskRefreshTimer) {
                clearInterval(diskRefreshTimer);
                diskRefreshTimer = null;
            }
        }

        // 更新硬盘使用率数据
        function updateDiskUsageData() {
            // 更新磁盘使用情况饼图
            fetch(`${API_BASE}/disk/info`)
                .then(response => response.json())
                .then(data => {
                    // 更新饼图
                    data.partitions.forEach(partition => {
                        const chart = diskCharts[`usage-${partition.driveLetter}`];
                        if (chart) {
                            // 根据使用率确定颜色和状态
                            let color, status;
                            if (partition.usagePercentage > 90) {
                                color = '#ef4444'; // 红色 - 危险
                                status = '危险';
                            } else if (partition.usagePercentage > 70) {
                                color = '#f97316'; // 橙色 - 警告
                                status = '警告';
                            } else {
                                color = '#22c55e'; // 绿色 - 良好
                                status = '良好';
                            }

                            chart.setOption({
                                series: [{
                                    data: [
                                        {
                                            value: (partition.usedSpace / (1024 ** 3)).toFixed(2),
                                            name: '已使用',
                                            itemStyle: { color: color }
                                        },
                                        {
                                            value: (partition.freeSpace / (1024 ** 3)).toFixed(2),
                                            name: '可用空间',
                                            itemStyle: { color: '#cbd5e1' }
                                        }
                                    ]
                                }],
                                series: [{
                                    label: {
                                        show: true,
                                        position: 'center',
                                        formatter: `${status}\n${partition.usagePercentage.toFixed(1)}%`,
                                        fontSize: 14,
                                        fontWeight: 'bold'
                                    }
                                }]
                            });
                        }
                    });
                })
                .catch(err => console.error('更新磁盘使用情况失败:', err));

            // 更新磁盘性能折线图
            fetch(`${API_BASE}/disk/performance`)
                .then(response => response.json())
                .then(data => {
                    updateDiskPerformanceChartData(data.performance);
                })
                .catch(err => console.error('更新磁盘性能失败:', err));
        }

        // 在窗口大小改变时重绘图表部分添加磁盘图表处理
        window.addEventListener('resize', function () {
            for (let chartName in charts) {
                if (charts[chartName]) {
                    charts[chartName].resize();
                }
            }
            // 处理磁盘图表
            for (let chartName in diskCharts) {
                if (diskCharts[chartName]) {
                    diskCharts[chartName].resize();
                }
            }
        });

        // 绑定进程相关事件
        function bindProcessEvents() {
            // 进程搜索事件
            document.getElementById('processSearch').addEventListener('input', function () {
                loadProcessData(this.value);
            });

            // 进程排序事件
            document.querySelectorAll('.sortable').forEach(th => {
                th.addEventListener('click', function () {
                    const field = this.getAttribute('data-sort');
                    sortProcesses(field);
                });
            });

            // 进程刷新控制事件
            document.getElementById('processRefreshToggle').addEventListener('click', toggleProcessRefresh);
            document.getElementById('processRefreshInterval').addEventListener('change', changeProcessRefreshInterval);
            document.getElementById('processDisplayCount').addEventListener('change', changeProcessDisplayCount);

            // 进程详情模态窗口事件
            document.getElementById('closeProcessDetailModal').addEventListener('click', closeProcessDetailModal);
        }


        // 进程刷新控制函数
        function toggleProcessRefresh() {
            processRefreshEnabled = !processRefreshEnabled;
            const toggleBtn = document.getElementById('processRefreshToggle');

            if (processRefreshEnabled) {
                toggleBtn.textContent = '暂停刷新';
                toggleBtn.className = 'bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm';
                startProcessRefresh();
            } else {
                toggleBtn.textContent = '开始刷新';
                toggleBtn.className = 'bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm';
                stopProcessRefresh();
            }
        }

        function changeProcessRefreshInterval() {
            processRefreshInterval = parseInt(document.getElementById('processRefreshInterval').value);
            if (processRefreshEnabled) {
                stopProcessRefresh();
                startProcessRefresh();
            }
        }

        function changeProcessDisplayCount() {
            const value = document.getElementById('processDisplayCount').value;
            processDisplayCount = value === 'all' ? Infinity : parseInt(value);
            loadProcessData(document.getElementById('processSearch').value);
        }

        function startProcessRefresh() {
            stopProcessRefresh(); // 先清除已有的定时器
            processRefreshTimer = setInterval(() => {
                loadProcessData(document.getElementById('processSearch').value);
            }, processRefreshInterval);
        }

        function stopProcessRefresh() {
            if (processRefreshTimer) {
                clearInterval(processRefreshTimer);
                processRefreshTimer = null;
            }
        }


        // 加载进程数据
        // 加载进程数据
        function loadProcessData(search = '') {
            fetch(`${API_BASE}/processes`)
                .then(response => response.json())
                .then(data => {
                    // 更新进程统计信息
                    document.getElementById('totalProcessCount').textContent = data.totalProcesses;
                    document.getElementById('totalThreadCount').textContent = data.totalThreads;

                    let processes = data.processes;

                    // 应用搜索过滤
                    if (search) {
                        processes = processes.filter(p =>
                            p.name.toLowerCase().includes(search.toLowerCase())
                        );
                    }

                    // 应用排序
                    processes.sort((a, b) => {
                        let aVal, bVal;

                        switch (processSort.field) {
                            case 'name':
                                aVal = a.name.toLowerCase();
                                bVal = b.name.toLowerCase();
                                break;
                            case 'pid':
                                aVal = a.pid;
                                bVal = b.pid;
                                break;
                            case 'cpu':
                                aVal = a.cpuUsage;
                                bVal = b.cpuUsage;
                                break;
                            case 'memory':
                                aVal = a.memoryUsage;
                                bVal = b.memoryUsage;
                                break;
                            default:
                                return 0;
                        }

                        if (processSort.direction === 'asc') {
                            return aVal > bVal ? 1 : -1;
                        } else {
                            return aVal < bVal ? 1 : -1;
                        }
                    });

                    // 应用显示数量限制
                    if (processDisplayCount !== Infinity) {
                        processes = processes.slice(0, processDisplayCount);
                    }

                    const processListTableBody = document.getElementById('processListTableBody');
                    processListTableBody.innerHTML = processes.map(process => `
                <tr>
                    <td class="py-2 px-4 border-b">${process.name}</td>
                    <td class="py-2 px-4 border-b">${process.pid}</td>
                    <td class="py-2 px-4 border-b">${process.cpuUsage.toFixed(2)}%</td>
                    <td class="py-2 px-4 border-b">${formatBytes(process.memoryUsage)}</td>
                    <td class="py-2 px-4 border-b">${process.threadCount}</td>
                    <td class="py-2 px-4 border-b">${process.state}</td>
                    <td class="py-2 px-4 border-b">
                        <button class="text-blue-500 hover:text-blue-700 process-detail" data-pid="${process.pid}">详情</button>
                    </td>
                </tr>
            `).join('');

                    // 绑定详情按钮事件
                    document.querySelectorAll('.process-detail').forEach(btn => {
                        btn.addEventListener('click', function () {
                            const pid = this.getAttribute('data-pid');
                            showProcessDetail(pid);
                        });
                    });
                })
                .catch(err => {
                    console.error('加载进程数据失败:', err);
                });
        }


        // 显示进程详情
        function showProcessDetail(pid) {
            fetch(`${API_BASE}/process/${pid}`)
                .then(response => response.json())
                .then(data => {
                    const detailContent = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold text-gray-700">基本信息</h4>
                        <div class="ml-2">
                            <p><span class="font-medium">进程名:</span> ${data.name}</p>
                            <p><span class="font-medium">PID:</span> ${data.pid}</p>
                            <p><span class="font-medium">父进程PID:</span> ${data.parentPid}</p>
                            <p><span class="font-medium">状态:</span> ${data.state}</p>
                            <p><span class="font-medium">优先级:</span> ${data.priority}</p>
                            <p><span class="font-medium">线程数:</span> ${data.threadCount}</p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-700">资源使用</h4>
                        <div class="ml-2">
                            <p><span class="font-medium">CPU使用率:</span> ${data.cpuUsage.toFixed(2)}%</p>
                            <p><span class="font-medium">内存使用:</span> ${formatBytes(data.memoryUsage)}</p>
                            <p><span class="font-medium">工作集大小:</span> ${formatBytes(data.workingSetSize)}</p>
                            <p><span class="font-medium">页面文件使用:</span> ${formatBytes(data.pagefileUsage)}</p>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <h4 class="font-semibold text-gray-700">其他信息</h4>
                        <div class="ml-2">
                            <p><span class="font-medium">命令行:</span> ${data.commandLine || 'N/A'}</p>
                            <p><span class="font-medium">完整路径:</span> ${data.fullPath || 'N/A'}</p>
                            <p><span class="font-medium">用户名:</span> ${data.username || 'N/A'}</p>
                            <p><span class="font-medium">创建时间:</span> ${new Date(data.createTime / 10000 - 11644473600000).toLocaleString()}</p>
                        </div>
                    </div>
                </div>
            `;
                    document.getElementById('processDetailContent').innerHTML = detailContent;
                    document.getElementById('processDetailModal').classList.remove('hidden');
                })
                .catch(err => {
                    console.error('获取进程详情失败:', err);
                    alert('获取进程详情失败');
                });
        }
        // 关闭进程详情模态窗口
        function closeProcessDetailModal() {
            document.getElementById('processDetailModal').classList.add('hidden');
        }


        // 终止进程
        function terminateProcess(pid) {
            fetch(`${API_BASE}/process/${pid}/terminate`, {
                method: 'POST'
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(`进程 PID: ${pid} 已终止`);
                        loadProcessData();
                    } else {
                        alert(`终止进程失败: ${data.error}`);
                    }
                })
                .catch(err => {
                    console.error('终止进程失败:', err);
                    alert(`终止进程失败: ${err.message}`);
                });
        }

        // 进程排序
        function sortProcesses(field) {
            if (processSort.field === field) {
                processSort.direction = processSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                processSort.field = field;
                processSort.direction = 'asc';
            }
            loadProcessData(document.getElementById('processSearch').value);
        }

        // 加载驱动数据
        function loadDriverData() {
            fetch(`${API_BASE}/drivers/snapshot`)
                .then(response => response.json())
                .then(data => {
                    // 更新驱动统计
                    const stats = data.statistics;
                    document.getElementById('totalDrivers').textContent = stats.totalDrivers;
                    document.getElementById('runningDrivers').textContent = stats.runningCount;
                    document.getElementById('stoppedDrivers').textContent = stats.stoppedCount;
                    document.getElementById('thirdPartyDrivers').textContent = stats.thirdPartyCount;

                    // 更新驱动类型分布图表
                    charts.driverTypeChart.setOption({
                        series: [{
                            data: [
                                { value: stats.kernelCount, name: '内核驱动' },
                                { value: stats.fileSystemCount, name: '文件系统' },
                                { value: stats.autoStartCount, name: '自启动' },
                                { value: stats.thirdPartyCount, name: '第三方' }
                            ]
                        }]
                    });

                    // 更新驱动列表
                    const allDrivers = [
                        ...data.runningDrivers.map(d => ({ ...d, state: '运行中' })),
                        ...data.stoppedDrivers.map(d => ({ ...d, state: '已停止' }))
                    ];

                    const driverTableBody = document.getElementById('driverTableBody');
                    driverTableBody.innerHTML = allDrivers.map(driver => `
                        <tr>
                            <td class="py-2 px-4 border-b">${driver.name}</td>
                            <td class="py-2 px-4 border-b">${driver.displayName}</td>
                            <td class="py-2 px-4 border-b">${driver.binaryPath}</td>
                            <td class="py-2 px-4 border-b">${driver.driverType || 'N/A'}</td>
                            <td class="py-2 px-4 border-b">${driver.state}</td>
                            <td class="py-2 px-4 border-b">${driver.startType}</td>
                        </tr>
                    `).join('');
                })
                .catch(err => {
                    console.error('加载驱动数据失败:', err);
                    document.getElementById('driverTableBody').innerHTML = `
                        <tr>
                            <td colspan="6" class="py-4 text-center text-red-500">
                                加载失败: ${err.message}
                            </td>
                        </tr>
                    `;
                });
        }

        // 加载快照数据
        function loadSnapshotData() {
            fetch(`${API_BASE}/registry/snapshots`)
                .then(response => response.json())
                .then(data => {
                    // 更新快照列表
                    const snapshotTableBody = document.getElementById('snapshotTableBody');
                    snapshotTableBody.innerHTML = data.map(snapshot => `
                        <tr>
                            <td class="py-2 px-4 border-b">${snapshot.name}</td>
                            <td class="py-2 px-4 border-b">${new Date(snapshot.timestamp).toLocaleString()}</td>
                            <td class="py-2 px-4 border-b">${snapshot.systemInfoCount}</td>
                            <td class="py-2 px-4 border-b">${snapshot.softwareCount}</td>
                            <td class="py-2 px-4 border-b">${snapshot.networkCount}</td>
                            <td class="py-2 px-4 border-b">
                                <button class="text-red-500 hover:text-red-700 delete-snapshot" data-name="${snapshot.name}">删除</button>
                            </td>
                        </tr>
                    `).join('');

                    // 绑定删除事件
                    document.querySelectorAll('.delete-snapshot').forEach(btn => {
                        btn.addEventListener('click', function () {
                            const name = this.getAttribute('data-name');
                            deleteSnapshot(name);
                        });
                    });

                    // 更新快照选择下拉框
                    const snapshot1Select = document.getElementById('snapshot1Select');
                    const snapshot2Select = document.getElementById('snapshot2Select');

                    let options = '<option value="">请选择快照</option>';
                    data.forEach(snapshot => {
                        options += `<option value="${snapshot.name}">${snapshot.name}</option>`;
                    });

                    snapshot1Select.innerHTML = options;
                    snapshot2Select.innerHTML = options;
                })
                .catch(err => {
                    console.error('加载快照数据失败:', err);
                    document.getElementById('snapshotTableBody').innerHTML = `
                        <tr>
                            <td colspan="6" class="py-4 text-center text-red-500">
                                加载失败: ${err.message}
                            </td>
                        </tr>
                    `;
                });
        }

        // 创建快照
        function createSnapshot() {
            const snapshotName = prompt('请输入快照名称:');
            if (!snapshotName) return;

            fetch(`${API_BASE}/registry/snapshot/save`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ snapshotName })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('快照创建成功');
                        loadSnapshotData();
                    } else {
                        alert(`快照创建失败: ${data.error}`);
                    }
                })
                .catch(err => {
                    console.error('创建快照失败:', err);
                    alert(`创建快照失败: ${err.message}`);
                });
        }

        // 删除快照
        function deleteSnapshot(name) {
            if (!confirm(`确定要删除快照 "${name}" 吗？`)) return;

            fetch(`${API_BASE}/registry/snapshots/delete/${name}`, {
                method: 'DELETE'
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('快照删除成功');
                        loadSnapshotData();
                    } else {
                        alert(`快照删除失败: ${data.error}`);
                    }
                })
                .catch(err => {
                    console.error('删除快照失败:', err);
                    alert(`删除快照失败: ${err.message}`);
                });
        }

        // 对比快照
        function compareSnapshots() {
            const snapshot1 = document.getElementById('snapshot1Select').value;
            const snapshot2 = document.getElementById('snapshot2Select').value;

            if (!snapshot1 || !snapshot2) {
                alert('请选择两个快照进行对比');
                return;
            }

            if (snapshot1 === snapshot2) {
                alert('请选择不同的快照进行对比');
                return;
            }

            fetch(`${API_BASE}/registry/snapshots/compare`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    snapshot1,
                    snapshot2
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(`对比失败: ${data.error}`);
                        return;
                    }

                    // 显示对比结果
                    document.getElementById('comparisonResult').style.display = 'block';

                    // 显示新增项
                    const addedItems = document.getElementById('addedItems');
                    if (data.systemInfoChanges && data.systemInfoChanges.added) {
                        addedItems.innerHTML = data.systemInfoChanges.added
                            .map(item => `<li>${item}</li>`)
                            .join('');
                    } else {
                        addedItems.innerHTML = '<li>无新增项</li>';
                    }

                    // 显示修改项
                    const modifiedItems = document.getElementById('modifiedItems');
                    if (data.systemInfoChanges && data.systemInfoChanges.modified) {
                        modifiedItems.innerHTML = data.systemInfoChanges.modified
                            .map(item => `<li>${item}</li>`)
                            .join('');
                    } else {
                        modifiedItems.innerHTML = '<li>无修改项</li>';
                    }

                    // 显示删除项
                    const removedItems = document.getElementById('removedItems');
                    if (data.systemInfoChanges && data.systemInfoChanges.removed) {
                        removedItems.innerHTML = data.systemInfoChanges.removed
                            .map(item => `<li>${item}</li>`)
                            .join('');
                    } else {
                        removedItems.innerHTML = '<li>无删除项</li>';
                    }
                })
                .catch(err => {
                    console.error('快照对比失败:', err);
                    alert(`快照对比失败: ${err.message}`);
                });
        }

        // 加载注册表数据
        function loadRegistryData() {
            fetch(`${API_BASE}/registry/snapshot`)
                .then(response => response.json())
                .then(data => {
                    // 更新注册表表格
                    const registryTableBody = document.getElementById('registryTableBody');

                    const allRegistryItems = [
                        ...data.systemInfo.map(item => ({ ...item, type: '系统信息' })),
                        ...data.software.map(item => ({ ...item, type: '软件' })),
                        ...data.network.map(item => ({ ...item, type: '网络' })),
                        ...data.autoStart.map(item => ({ ...item, type: '自启动' }))
                    ];

                    registryTableBody.innerHTML = allRegistryItems.map(item => `
                        <tr>
                            <td class="py-2 px-4 border-b">${item.type}</td>
                            <td class="py-2 px-4 border-b">${item.path}</td>
                            <td class="py-2 px-4 border-b">${item.subkeys ? item.subkeys.length : 0}</td>
                            <td class="py-2 px-4 border-b">${item.values ? item.values.length : 0}</td>
                        </tr>
                    `).join('');

                    // 更新注册表图表
                    charts.registryChart.setOption({
                        series: [{
                            data: [
                                { value: data.systemInfo.length, name: '系统信息' },
                                { value: data.software.length, name: '软件' },
                                { value: data.network.length, name: '网络' },
                                { value: data.autoStart.length, name: '自启动' }
                            ]
                        }]
                    });
                })
                .catch(err => {
                    console.error('加载注册表数据失败:', err);
                    document.getElementById('registryTableBody').innerHTML = `
                        <tr>
                            <td colspan="4" class="py-4 text-center text-red-500">
                                加载失败: ${err.message}
                            </td>
                        </tr>
                    `;
                });
        }

        // CPU刷新控制函数
        function toggleCpuRefresh() {
            cpuRefreshEnabled = !cpuRefreshEnabled;
            const toggleBtn = document.getElementById('cpuRefreshToggle');

            if (cpuRefreshEnabled) {
                toggleBtn.textContent = '暂停刷新';
                toggleBtn.className = 'bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm';
                startCpuRefresh();
            } else {
                toggleBtn.textContent = '开始刷新';
                toggleBtn.className = 'bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm';
                stopCpuRefresh();
            }
        }

        function changeCpuRefreshInterval() {
            cpuRefreshInterval = parseInt(document.getElementById('cpuRefreshInterval').value);
            if (cpuRefreshEnabled) {
                stopCpuRefresh();
                startCpuRefresh();
            }
        }

        function startCpuRefresh() {
            stopCpuRefresh(); // 先清除已有的定时器
            cpuRefreshTimer = setInterval(() => {
                updateCpuUsageData();
            }, cpuRefreshInterval);
        }

        function stopCpuRefresh() {
            if (cpuRefreshTimer) {
                clearInterval(cpuRefreshTimer);
                cpuRefreshTimer = null;
            }
        }

        // 内存刷新控制函数
        function toggleMemoryRefresh() {
            memoryRefreshEnabled = !memoryRefreshEnabled;
            const toggleBtn = document.getElementById('memoryRefreshToggle');

            if (memoryRefreshEnabled) {
                toggleBtn.textContent = '暂停刷新';
                toggleBtn.className = 'bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm';
                startMemoryRefresh();
            } else {
                toggleBtn.textContent = '开始刷新';
                toggleBtn.className = 'bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm';
                stopMemoryRefresh();
            }
        }

        function changeMemoryRefreshInterval() {
            memoryRefreshInterval = parseInt(document.getElementById('memoryRefreshInterval').value);
            if (memoryRefreshEnabled) {
                stopMemoryRefresh();
                startMemoryRefresh();
            }
        }

        function startMemoryRefresh() {
            stopMemoryRefresh(); // 先清除已有的定时器
            memoryRefreshTimer = setInterval(() => {
                updateMemoryUsageData();
            }, memoryRefreshInterval);
        }

        function stopMemoryRefresh() {
            if (memoryRefreshTimer) {
                clearInterval(memoryRefreshTimer);
                memoryRefreshTimer = null;
            }
        }

        // 更新CPU使用率数据
        function updateCpuUsageData() {
            // 更新当前CPU使用率
            fetch(`${API_BASE}/cpu/usage`)
                .then(response => response.json())
                .then(data => {
                    const usage = data.usage.toFixed(2);
                    charts.cpuUsageGauge.setOption({
                        series: [{
                            data: [{ value: usage }]
                        }]
                    });

                    // 更新状态显示
                    updateCpuStatus(usage);
                })
                .catch(err => console.error('更新CPU使用率失败:', err));

            // 更新历史数据
            fetch(`${API_BASE}/cpu/history`)
                .then(response => response.json())
                .then(data => {
                    const chartData = data.map(item => [item.timestamp, item.value]);
                    charts.cpuHistoryChart.setOption({
                        series: [{
                            data: chartData
                        }]
                    });
                })
                .catch(err => console.error('更新CPU历史数据失败:', err));
        }

        // 更新内存使用率数据
        function updateMemoryUsageData() {
            // 更新当前内存使用率
            fetch(`${API_BASE}/memory/usage`)
                .then(response => response.json())
                .then(data => {
                    const percent = data.usedPercent;
                    charts.memoryUsageGauge.setOption({
                        series: [{
                            data: [{ value: percent }]
                        }]
                    });

                    // 更新内存状态显示
                    updateMemoryStatus(percent);

                    // 更新内存详细信息
                    document.getElementById('totalMemory').textContent = formatBytes(data.totalPhysical);
                    document.getElementById('usedMemory').textContent = formatBytes(data.usedPhysical);
                    document.getElementById('availableMemory').textContent = formatBytes(data.availablePhysical);
                })
                .catch(err => console.error('更新内存使用率失败:', err));

            // 更新历史数据
            fetch(`${API_BASE}/memory/history`)
                .then(response => response.json())
                .then(data => {
                    const chartData = data.map(item => [item.timestamp, item.value]);
                    charts.memoryHistoryChart.setOption({
                        series: [{
                            data: chartData
                        }]
                    });
                })
                .catch(err => console.error('更新内存历史数据失败:', err));
        }

        // 更新CPU状态显示
        function updateCpuStatus(usage) {
            const statusText = document.getElementById('cpuStatusText');
            const statusDescription = document.getElementById('cpuStatusDescription');

            if (usage > 95) {
                statusText.textContent = '危险';
                statusText.className = 'text-lg font-semibold text-red-600';
                statusDescription.textContent = 'CPU使用率过高';
                statusDescription.className = 'text-sm text-red-500';
            } else if (usage > 80) {
                statusText.textContent = '警告';
                statusText.className = 'text-lg font-semibold text-orange-500';
                statusDescription.textContent = 'CPU使用率较高';
                statusDescription.className = 'text-sm text-orange-400';
            } else {
                statusText.textContent = '良好';
                statusText.className = 'text-lg font-semibold text-green-600';
                statusDescription.textContent = 'CPU使用率正常';
                statusDescription.className = 'text-sm text-gray-500';
            }
        }

        // 格式化字节大小
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 窗口大小改变时重绘图表
        window.addEventListener('resize', function () {
            for (let chartName in charts) {
                if (charts[chartName]) {
                    charts[chartName].resize();
                }
            }
        });

        // 页面卸载时清理定时器
        window.addEventListener('beforeunload', function () {
            stopCpuRefresh();
            stopMemoryRefresh();
            stopDiskRefresh();
        });
    </script>
</body>

</html>