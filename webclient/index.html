<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统监控工具</title>
    <script src="js/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 28px;
            font-weight: 300;
        }

        .nav-tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #c0c0c0;
            transition: all 0.3s ease;
            border-radius: 8px;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #ffffff;
        }

        .nav-tab.active {
            background: rgba(67, 133, 245, 0.2);
            color: #4385f5;
            font-weight: 500;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 500;
            color: #ffffff;
        }

        .metric-value {
            font-size: 36px;
            font-weight: 300;
            color: #4385f5;
            margin: 10px 0;
        }

        .metric-label {
            font-size: 14px;
            color: #a0a0a0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4385f5, #34a853);
            transition: width 0.5s ease;
        }

        .chart-container {
            height: 300px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-primary {
            background: rgba(67, 133, 245, 0.2);
            color: #4385f5;
        }

        .btn-primary:hover {
            background: rgba(67, 133, 245, 0.3);
            transform: translateY(-2px);
        }

        .btn-success {
            background: rgba(52, 168, 83, 0.2);
            color: #34a853;
        }

        .btn-success:hover {
            background: rgba(52, 168, 83, 0.3);
        }

        .snapshot-list {
            display: grid;
            gap: 15px;
        }

        .snapshot-item {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .snapshot-item:hover {
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
            transform: translateX(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .snapshot-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .snapshot-info p {
            color: #a0a0a0;
            font-size: 14px;
        }

        .snapshot-actions {
            display: flex;
            gap: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(30, 40, 60, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 16px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            font-size: 28px;
            cursor: pointer;
            color: #a0a0a0;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #ffffff;
        }

        .comparison-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-metric {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .comparison-metric h4 {
            color: #a0a0a0;
            margin-bottom: 10px;
        }

        .comparison-value {
            font-size: 24px;
            font-weight: 500;
        }

        .value-increased {
            color: #ea4335;
        }

        .value-decreased {
            color: #34a853;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .comparison-view {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>系统监控工具</h1>
            <div>
                <span id="currentTime"></span>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">实时监控</button>
            <button class="nav-tab" onclick="switchTab('snapshots')">快照管理</button>
            <button class="nav-tab" onclick="switchTab('comparison')">对比分析</button>
        </div>

        <!-- 实时监控面板 -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">CPU 使用率</h2>
                        <button class="btn btn-primary" onclick="refreshCPU()">刷新</button>
                    </div>
                    <div class="metric-value" id="cpuValue">0%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="cpuProgress" style="width: 0%"></div>
                    </div>
                    <div class="chart-container" id="cpuChart"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">内存使用</h2>
                        <button class="btn btn-primary" onclick="refreshMemory()">刷新</button>
                    </div>
                    <div class="metric-value" id="memoryValue">0%</div>
                    <div class="metric-label" id="memoryLabel">0 GB / 0 GB</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="memoryProgress" style="width: 0%"></div>
                    </div>
                    <div class="chart-container" id="memoryChart"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">磁盘 I/O</h2>
                        <button class="btn btn-primary" onclick="refreshDiskIO()">刷新</button>
                    </div>
                    <div class="metric-value" id="diskRead">0 MB/s</div>
                    <div class="metric-label">读取速度</div>
                    <div class="metric-value" id="diskWrite">0 MB/s</div>
                    <div class="metric-label">写入速度</div>
                    <div class="chart-container" id="diskChart"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">进程监控</h2>
                        <button class="btn btn-primary" onclick="refreshProcesses()">刷新</button>
                    </div>
                    <div class="metric-value" id="processCount">0</div>
                    <div class="metric-label">活跃进程数</div>
                    <div style="margin-top: 20px; max-height: 200px; overflow-y: auto;">
                        <table style="width: 100%; font-size: 14px;">
                            <thead>
                                <tr style="color: #666; border-bottom: 1px solid #eee;">
                                    <th style="text-align: left; padding: 5px;">进程名</th>
                                    <th style="text-align: right; padding: 5px;">CPU</th>
                                    <th style="text-align: right; padding: 5px;">内存</th>
                                </tr>
                            </thead>
                            <tbody id="processList"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">注册表信息</h2>
                    <button class="btn btn-primary" onclick="refreshRegistry()">刷新</button>
                </div>
                <div id="registryInfo" style="font-family: monospace; font-size: 14px; max-height: 300px; overflow-y: auto;">
                    <p style="color: #999;">点击刷新按钮加载注册表信息</p>
                </div>
            </div>
        </div>

        <!-- 快照管理面板 -->
        <div id="snapshots" class="tab-content">
            <div style="margin-bottom: 20px;">
                <button class="btn btn-success" onclick="createSnapshot()">
                    <span style="margin-right: 5px;">+</span>创建新快照
                </button>
            </div>
            <div class="snapshot-list" id="snapshotList"></div>
        </div>

        <!-- 对比分析面板 -->
        <div id="comparison" class="tab-content">
            <div style="margin-bottom: 20px;">
                <h2 style="margin-bottom: 10px;">选择要对比的快照</h2>
                <div id="comparisonSelector" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
                <button class="btn btn-primary" onclick="compareSnapshots()" style="margin-top: 10px;">
                    开始对比
                </button>
            </div>
            <div id="comparisonResult"></div>
        </div>
    </div>

    <!-- 对比报告模态框 -->
    <div id="comparisonModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>快照对比报告</h2>
                <span class="close-btn" onclick="closeModal()">&times;</span>
            </div>
            <div id="comparisonReport"></div>
        </div>
    </div>

    <script>
        // 全局变量
        let currentTab = 'dashboard';
        let cpuChart, memoryChart, diskChart;
        let cpuData = [], memoryData = [], diskReadData = [], diskWriteData = [];
        let snapshots = [];
        let selectedSnapshots = [];

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            initCharts();
            loadSnapshots();
            startRealTimeUpdate();
        });

        // 更新当前时间
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleString('zh-CN', { 
                    year: 'numeric', 
                    month: '2-digit', 
                    day: '2-digit', 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit' 
                });
        }

        // 初始化图表
        function initCharts() {
            // CPU图表
            cpuChart = echarts.init(document.getElementById('cpuChart'));
            cpuChart.setOption({
                title: { text: 'CPU使用趋势', textStyle: { fontSize: 14 } },
                tooltip: { trigger: 'axis' },
                xAxis: { 
                    type: 'category', 
                    data: [],
                    axisLabel: {
                        color: '#a0a0a0'
                    }
                },
                yAxis: { 
                    type: 'value', 
                    min: 0, 
                    max: 100,
                    axisLabel: {
                        color: '#a0a0a0'
                    }
                },
                series: [{
                    name: 'CPU使用率',
                    type: 'line',
                    data: [],
                    smooth: true,
                    itemStyle: { color: '#667eea' },
                    areaStyle: { 
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(67, 133, 245, 0.5)' },
                            { offset: 1, color: 'rgba(67, 133, 245, 0.1)' }
                        ])
                    }
                }]
            });

            // 内存图表
            memoryChart = echarts.init(document.getElementById('memoryChart'));
            memoryChart.setOption({
                title: { text: '内存使用趋势', textStyle: { fontSize: 14 } },
                tooltip: { trigger: 'axis' },
                xAxis: { 
                    type: 'category', 
                    data: [],
                    axisLabel: {
                        color: '#a0a0a0'
                    }
                },
                yAxis: { 
                    type: 'value', 
                    min: 0, 
                    max: 100,
                    axisLabel: {
                        color: '#a0a0a0'
                    }
                },
                series: [{
                    name: '内存使用率',
                    type: 'line',
                    data: [],
                    smooth: true,
                    itemStyle: { color: '#764ba2' },
                    areaStyle: { 
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(118, 75, 162, 0.5)' },
                            { offset: 1, color: 'rgba(118, 75, 162, 0.1)' }
                        ])
                    }
                }]
            });

            // 磁盘IO图表
            diskChart = echarts.init(document.getElementById('diskChart'));
            diskChart.setOption({
                title: { text: '磁盘I/O趋势', textStyle: { fontSize: 14 } },
                tooltip: { trigger: 'axis' },
                legend: { data: ['读取', '写入'] },
                xAxis: { 
                    type: 'category', 
                    data: [],
                    axisLabel: {
                        color: '#a0a0a0'
                    }
                },
                yAxis: { 
                    type: 'value', 
                    axisLabel: { 
                        formatter: '{value} MB/s',
                        color: '#a0a0a0'
                    } 
                },
                series: [
                    {
                        name: '读取',
                        type: 'line',
                        data: [],
                        smooth: true,
                        itemStyle: { color: '#667eea' }
                    },
                    {
                        name: '写入',
                        type: 'line',
                        data: [],
                        smooth: true,
                        itemStyle: { color: '#764ba2' }
                    }
                ]
            });
        }

        // 切换标签页
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab).classList.add('active');

            if (tab === 'snapshots') {
                loadSnapshots();
            } else if (tab === 'comparison') {
                updateComparisonSelector();
            }
        }

        // 开始实时更新
        function startRealTimeUpdate() {
            // 初始加载
            refreshCPU();
            refreshMemory();
            refreshDiskIO();
            refreshProcesses();
            
            // 每5秒更新一次
            setInterval(() => {
                if (currentTab === 'dashboard') {
                    refreshCPU();
                    refreshMemory();
                    refreshDiskIO();
                }
            }, 5000);
        }

        // 刷新CPU信息
        async function refreshCPU() {
            try {
                const response = await fetch('/api/v1/monitor/cpu-memory');
                const data = await response.json();
                
                const cpuUsage = data.cpu.usage_percent;
                document.getElementById('cpuValue').textContent = cpuUsage.toFixed(1) + '%';
                document.getElementById('cpuProgress').style.width = cpuUsage + '%';
                
                // 更新图表
                const time = new Date().toLocaleTimeString();
                cpuData.push({ time, value: cpuUsage });
                if (cpuData.length > 20) cpuData.shift();
                
                cpuChart.setOption({
                    xAxis: { data: cpuData.map(d => d.time) },
                    series: [{ data: cpuData.map(d => d.value) }]
                });
            } catch (error) {
                console.error('获取CPU信息失败:', error);
            }
        }

        // 刷新内存信息
        async function refreshMemory() {
            try {
                const response = await fetch('/api/v1/monitor/cpu-memory');
                const data = await response.json();
                
                const memoryUsage = data.memory.usage_percent;
                const totalGB = (data.memory.total_bytes / 1024 / 1024 / 1024).toFixed(1);
                const usedGB = (data.memory.used_bytes / 1024 / 1024 / 1024).toFixed(1);
                
                document.getElementById('memoryValue').textContent = memoryUsage.toFixed(1) + '%';
                document.getElementById('memoryLabel').textContent = `${usedGB} GB / ${totalGB} GB`;
                document.getElementById('memoryProgress').style.width = memoryUsage + '%';
                
                // 更新图表
                const time = new Date().toLocaleTimeString();
                memoryData.push({ time, value: memoryUsage });
                if (memoryData.length > 20) memoryData.shift();
                
                memoryChart.setOption({
                    xAxis: { data: memoryData.map(d => d.time) },
                    series: [{ data: memoryData.map(d => d.value) }]
                });
            } catch (error) {
                console.error('获取内存信息失败:', error);
            }
        }

        // 刷新磁盘IO
        async function refreshDiskIO() {
            try {
                const response = await fetch('/api/v1/monitor/disk-io');
                const data = await response.json();
                
                const diskData = data.disk_io[0]; // 取第一个磁盘
                const readMB = (diskData.read_bytes / 1024 / 1024).toFixed(1);
                const writeMB = (diskData.write_bytes / 1024 / 1024).toFixed(1);
                
                document.getElementById('diskRead').textContent = readMB + ' MB/s';
                document.getElementById('diskWrite').textContent = writeMB + ' MB/s';
                
                // 更新图表
                const time = new Date().toLocaleTimeString();
                diskReadData.push(parseFloat(readMB));
                diskWriteData.push(parseFloat(writeMB));
                if (diskReadData.length > 20) {
                    diskReadData.shift();
                    diskWriteData.shift();
                }
                
                diskChart.setOption({
                    xAxis: { data: data.disk_io.map((_, i) => i) },
                    series: [
                        { data: diskReadData },
                        { data: diskWriteData }
                    ]
                });
            } catch (error) {
                console.error('获取磁盘IO信息失败:', error);
            }
        }

        // 刷新进程信息
        async function refreshProcesses() {
            try {
                const response = await fetch('/api/v1/monitor/processes?limit=10');
                const data = await response.json();
                
                document.getElementById('processCount').textContent = data.processes.length;
                
                const processList = document.getElementById('processList');
                processList.innerHTML = '';
                
                data.processes.forEach(proc => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="padding: 5px;">${proc.name}</td>
                        <td style="text-align: right; padding: 5px;">${proc.cpu_percent.toFixed(1)}%</td>
                        <td style="text-align: right; padding: 5px;">${(proc.memory_bytes / 1024 / 1024).toFixed(0)}MB</td>
                    `;
                    processList.appendChild(row);
                });
            } catch (error) {
                console.error('获取进程信息失败:', error);
            }
        }

        // 刷新注册表信息
        async function refreshRegistry() {
            try {
                const response = await fetch('/api/v1/monitor/registry');
                const data = await response.json();
                
                const registryInfo = document.getElementById('registryInfo');
                registryInfo.innerHTML = '';
                
                data.entries.forEach(entry => {
                    const div = document.createElement('div');
                    div.style.marginBottom = '10px';
                    div.innerHTML = `
                        <strong>${entry.name}</strong>: 
                        <span style="color: #667eea;">${entry.value}</span> 
                        <span style="color: #999;">(${entry.type})</span>
                    `;
                    registryInfo.appendChild(div);
                });
            } catch (error) {
                console.error('获取注册表信息失败:', error);
            }
        }

        // 创建快照
        async function createSnapshot() {
            const name = prompt('请输入快照名称:');
            if (!name) return;
            
            const description = prompt('请输入快照描述（可选）:') || '';
            
            try {
                const response = await fetch('/api/v1/snapshot/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description })
                });
                
                if (response.ok) {
                    alert('快照创建成功！');
                    loadSnapshots();
                } else {
                    alert('快照创建失败！');
                }
            } catch (error) {
                console.error('创建快照失败:', error);
                alert('快照创建失败！');
            }
        }

        // 加载快照列表
        async function loadSnapshots() {
            try {
                const response = await fetch('/api/v1/snapshots');
                const data = await response.json();
                snapshots = data.snapshots;
                
                const snapshotList = document.getElementById('snapshotList');
                snapshotList.innerHTML = '';
                
                snapshots.forEach(snapshot => {
                    const div = document.createElement('div');
                    div.className = 'snapshot-item';
                    div.innerHTML = `
                        <div class="snapshot-info">
                            <h3>${snapshot.name}</h3>
                            <p>${snapshot.description || '无描述'}</p>
                            <p style="color: #999; font-size: 12px;">创建时间: ${new Date(snapshot.created_at).toLocaleString()}</p>
                        </div>
                        <div class="snapshot-actions">
                            <button class="btn btn-primary" onclick="viewSnapshot('${snapshot.snapshot_id}')">查看</button>
                            <button class="btn" onclick="deleteSnapshot('${snapshot.snapshot_id}')">删除</button>
                        </div>
                    `;
                    snapshotList.appendChild(div);
                });
            } catch (error) {
                console.error('加载快照列表失败:', error);
            }
        }

        // 查看快照详情
        async function viewSnapshot(snapshotId) {
            try {
                const response = await fetch(`/api/v1/snapshot/${snapshotId}`);
                const data = await response.json();
                
                // 这里可以显示快照详情的模态框
                alert('快照详情功能开发中...');
            } catch (error) {
                console.error('查看快照失败:', error);
            }
        }

        // 删除快照
        async function deleteSnapshot(snapshotId) {
            if (!confirm('确定要删除这个快照吗？')) return;
            
            try {
                const response = await fetch(`/api/v1/snapshot/${snapshotId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('快照删除成功！');
                    loadSnapshots();
                }
            } catch (error) {
                console.error('删除快照失败:', error);
            }
        }

        // 更新对比选择器
        function updateComparisonSelector() {
            const selector = document.getElementById('comparisonSelector');
            selector.innerHTML = '';
            
            snapshots.forEach(snapshot => {
                const label = document.createElement('label');
                label.style.display = 'flex';
                label.style.alignItems = 'center';
                label.style.gap = '5px';
                label.innerHTML = `
                    <input type="checkbox" value="${snapshot.snapshot_id}" onchange="updateSelectedSnapshots(this)">
                    <span>${snapshot.name} - ${new Date(snapshot.created_at).toLocaleString()}</span>
                `;
                selector.appendChild(label);
            });
        }

        // 更新选中的快照
        function updateSelectedSnapshots(checkbox) {
            if (checkbox.checked) {
                if (selectedSnapshots.length < 2) {
                    selectedSnapshots.push(checkbox.value);
                } else {
                    alert('最多只能选择2个快照进行对比！');
                    checkbox.checked = false;
                }
            } else {
                selectedSnapshots = selectedSnapshots.filter(id => id !== checkbox.value);
            }
        }

        // 对比快照
        async function compareSnapshots() {
            if (selectedSnapshots.length !== 2) {
                alert('请选择2个快照进行对比！');
                return;
            }
            
            try {
                const response = await fetch('/api/v1/snapshot/compare', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        snapshot_ids: selectedSnapshots,
                        comparison_type: 'all'
                    })
                });
                
                const reportHtml = await response.text();
                document.getElementById('comparisonReport').innerHTML = reportHtml;
                document.getElementById('comparisonModal').classList.add('active');
            } catch (error) {
                console.error('对比快照失败:', error);
            }
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById('comparisonModal').classList.remove('active');
        }

        // 窗口大小改变时重新渲染图表
        window.addEventListener('resize', () => {
            cpuChart.resize();
            memoryChart.resize();
            diskChart.resize();
        });
    </script>
</body>
</html>